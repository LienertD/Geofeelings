(function () {
    "use strict";

    var app = angular.module("geofeelings", ["ngRoute"]);

    app.config(function ($routeProvider) {
        $routeProvider
            .when("/admin", {
                templateUrl: "./controllers/adminController/admin.html"
            }).when("/search", {
                templateUrl: "./controllers/searchController/search.html"
            }).when("/intro", {
                templateUrl: "./controllers/introController/intro.html"
            }).when("/help", {
                templateUrl: "./directives/help.html"
            }).when("/login", {
                templateUrl: "./controllers/loginController/login.html"
            }).when("/register", {
                templateUrl: "./controllers/loginController/register.html"
            }).when("/password", {
                templateUrl: "./controllers/loginController/password.html"
            }).when("/user", {
                templateUrl: "./controllers/userController/user.html"
            }).when("/user/:param", {
                templateUrl: "./controllers/userController/user.html",
                controller: 'userController'
            }).when("/me", {
                templateUrl: "./controllers/userController/me.html"
            }).when("/event", {
                templateUrl: "./controllers/eventController/event.html"
            }).when("/addEvent", {
                templateUrl: "./controllers/eventController/addEvent.html"
            }).when("/location", {
                templateUrl: "./controllers/locationController/location.html"
            }).when("/intro_shared", {
                templateUrl: "./controllers/introController/intro_shared.html"
            }).otherwise({
                redirectTo: "/intro"
            });
    });

    app.directive("searchresult", function () {
        return {
            restrict: 'E',
            templateUrl: 'directives/searchResult.html'
        };
    });

    app.service('sharedProperties', function () {
        var property = 'First';

        return {
            getProperty: function () {
                return property;
            },
            setProperty: function (value) {
                property = value;
            }
        };
    });

})();

/**
 * Created by Jonatan on 4/12/2015.
 */


(function () {
    "use strict";

    var eventController = function ($scope) {

    };

    angular.module("geofeelings").controller("eventController", ["$scope", eventController]);
})();
/**
 * Created by Jonatan on 6/12/2015.
 */

(function () {
    "use strict";

    var adminController = function ($scope) {

    };

    angular.module("geofeelings").controller("adminController", ["$scope", adminController]);
})();
/**
 * Created by Jonatan on 1/12/2015.
 */

(function () {
    "use strict";

    var introController = function ($scope, shareService, $http, $location, profileService,shareVarsBetweenCtrl) {


        //SMILEY TEKENEN
        $scope.sliderValue = 50;
        $scope.moodWord = null;
        var c = document.getElementById("smileyCanvas");
        var ctx = c.getContext("2d");

        var sadRGB = [152, 30, 30];
        var happyRGB = [70, 161, 73];

        //telkens slidervalue verandert gezichtje tekenen
        $scope.$watch("sliderValue", function () {
            ctx.clearRect(0, 0, c.width, c.height); //canvas clearen voor nieuw frame

            var mood = $scope.sliderValue;
            giveMoodWord();
            //offset positie mond
            var offsetX = c.width / 5;
            var offSetY = c.width / 2.14 + (mood / (c.width / 6));

            //variabelen voor beziercurve (= mond)
            var SPx = offsetX;
            var SPy = offSetY + c.width / 3 - (mood * (c.width / 376.66));
            var H1x = offsetX;
            var H1y = offSetY + (mood * (c.width / 250));
            var H2x = offsetX + ((c.width / 300) * 180);
            var H2y = offSetY + (mood * (c.width / 250));
            var EPx = offsetX + (c.width / 1.666);
            var EPy = offSetY + (c.width / 3) - (mood * (c.width / 376.66));

            //hoofd
            ctx.lineWidth = c.width / 60;
            ctx.beginPath();
            ctx.arc((c.width / 2), (c.width / 2), (c.width / 2.07), 0, 2 * Math.PI);
            ctx.fillStyle = "rgb(" + moodColor(0) + "," + moodColor(1) + "," + moodColor(2) + ")";
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.stroke();

            //mond

            ctx.lineWidth = c.width / 30;
            ctx.beginPath();
            ctx.moveTo(SPx, SPy);
            ctx.bezierCurveTo(H1x, H1y, H2x, H2y, EPx, EPy);
            ctx.strokeStyle = 'black';
            ctx.stroke();
            ctx.lineCap = "round";

            //oog links

            ctx.lineWidth = c.width / 60;
            ctx.beginPath();
            ctx.arc(c.width / 3, c.width / 3, c.width / 15, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.stroke();

            //oog rechts
            ctx.beginPath();
            ctx.arc(c.width / 3 * 2, c.width / 3, c.width / 15, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.stroke();
        });

        var moodColor = function (c) {
            //c: R = 0, G = 1, B = 2

            if (sadRGB[c] > happyRGB[c]) {
                return Math.round(sadRGB[c] - ((sadRGB[c] - happyRGB[c]) * ($scope.sliderValue / 100)));
            }
            else {
                return Math.round(sadRGB[c] + ((happyRGB[c] - sadRGB[c]) * ($scope.sliderValue / 100)));
            }

        };

        var moodwords = ["horrible", "really bad", "bad", "okay", "good", "really good", "excellent"];

        var giveMoodWord = function () {
            if ($scope.sliderValue < 5) {
                $scope.moodWord = moodwords[0];
            }
            else if ($scope.sliderValue < 25) {
                $scope.moodWord = moodwords[1];
            }
            else if ($scope.sliderValue < 40) {
                $scope.moodWord = moodwords[2];
            }
            else if ($scope.sliderValue < 60) {
                $scope.moodWord = moodwords[3];
            }
            else if ($scope.sliderValue < 75) {
                $scope.moodWord = moodwords[4];
            }
            else if ($scope.sliderValue < 95) {
                $scope.moodWord = moodwords[5];
            }
            else {
                $scope.moodWord = moodwords[6];
            }
        };

        $http.get('/auth/user').success(function (data) {
            $scope.user = data;
        });
        $scope.sharePosted = false;
        $scope.postShare = function () {
            $scope.sharePosted = true;
            profileService.getUser(function (err, data) {
                if (!err) {
                    if (data.redirect) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var userlessShareData = {
                                "userid": 0,
                                "eventid": 0,
                                "time": new Date().toISOString(),
                                "mood": $scope.sliderValue,
                                "lat": position.coords.latitude,
                                "lng": position.coords.longitude
                            };

                            shareVarsBetweenCtrl.saveUserlessShare(userlessShareData);
                        });
                        $location.path(data.redirect);

                    } else {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var data = {
                                "userid": $scope.user._id,
                                "eventid": 0,
                                "time": new Date().toISOString(),
                                "mood": $scope.sliderValue,
                                "lat": position.coords.latitude,
                                "lng": position.coords.longitude
                            };
                            shareService.postShare(data);
                        });
                    }
                } else {
                    console.log("error: " + err);
                }
            });
        };
    };

    angular.module("geofeelings").controller("introController", ["$scope", "shareService", "$http", "$location", "profileService","shareVarsBetweenCtrl", introController]);
})();
/**
 * Created by Lienert on 21/12/2015.
 */

(function () {
    "use strict";

    var intro_sharedController = function ($scope, shareVarsBetweenCtrl,profileService) {
        $scope.infoPostedShare = shareVarsBetweenCtrl.getProperty().share;
    };
    angular.module("geofeelings").controller("intro_sharedController", ["$scope", "shareVarsBetweenCtrl","profileService", intro_sharedController]);
})();
/**
 * Created by Jonatan on 6/12/2015.
 */

(function () {
    "use strict";

    var locationController = function ($scope) {

    };

    angular.module("geofeelings").controller("locationController", ["$scope", locationController]);
})();
/**
 * Created by Jonatan on 26/11/2015.
 */

(function () {
    "use strict";

    var loginController = function ($scope, $http, $location, shareVarsBetweenCtrl, shareService, profileService) {

        var postUserlessShare = function(){
            var shareData = shareVarsBetweenCtrl.returnUserlessShare();
            profileService.getUser(function (err, user) {
                if (!err) {
                    if (user.redirect) {
                        $location.path(user.redirect);
                    } else {
                        shareData.userid = user.id;
                        shareService.postShare(shareData); //post de share met de inlogdata dat hij nu weet
                        shareVarsBetweenCtrl.saveUserlessShare("");
                    }
                } else {
                    console.log("> error profileService: " + err);
                }
            });
        };

        $scope.login = function () {
            $http.post('http://localhost:3000/auth/login', {
                username: $scope.username,
                password: $scope.password
            }).success(function (data) {
                $scope.error = data.error;
                if (shareVarsBetweenCtrl.returnUserlessShare() !== undefined && shareVarsBetweenCtrl.returnUserlessShare() !== "") //user heeft willen sharen, maar was niet ingelogd.
                {
                    postUserlessShare();
                }
                else {
                    $location.path(data.redirect);
                }
            });
        };

        $scope.register = function () {
            $http.post('http://localhost:3000/auth/register', {
                username: $scope.username,
                password: $scope.password,
                email: $scope.email
            }).success(function (data) {
                $scope.error = data.error;
                if (shareVarsBetweenCtrl.returnUserlessShare() !== undefined && shareVarsBetweenCtrl.returnUserlessShare() !== "") //user heeft willen sharen, maar was niet ingelogd.
                {
                    postUserlessShare();
                }
                else {
                    $location.path(data.redirect);
                }
            });
        };
    };

    angular.module("geofeelings").controller("loginController", ["$scope", "$http", "$location", "shareVarsBetweenCtrl", "shareService", "profileService", loginController]);
})();
/**
 * Created by Jonatan on 25/11/2015.
 */


(function () {
    "use strict";

    var searchController = function ($scope, searchService, sharedProperties) {

        $scope.searchModel = null;

        $scope.searchOnSubmit = function (formObj) {
            if ($scope.searchModel.length > 0) {
                searchNow();
            }
        };
        $scope.searchOnKeyPress = function () {
            if ($scope.searchModel !== null) {
                searchNow();
            }
        };

        $scope.filterSearchResults = function (i) {
            if ($scope.searchModel === "") {
                return false;
            }

            if (i.username.toLowerCase().indexOf($scope.searchModel.toLocaleLowerCase()) >= 0) {
                return true;
            }
            if (i.description !== undefined) {
                if (i.description.toLowerCase().indexOf($scope.searchModel.toLocaleLowerCase()) >= 0) {
                    return true;
                }
            }

            return false;
        };


        var searchNow = function () {
            searchService.search($scope.searchModel).then(onResultsReady);
        };

        var onResultsReady = function (res) {
            $scope.searchResults = res;
        };

        var onResultsError = function (err) {
        };
    };

    angular.module("geofeelings").controller("searchController", ["$scope", "searchService","sharedProperties", searchController]);
})();
/**
 * Created by Jonatan on 21/11/2015.
 */

(function () {
    "use strict";

    var mainController = function ($scope) {
        if (navigator.geolocation) {
            $scope.image = "./assets/location_now.png";
            $scope.mapOptions = {
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                disableDefaultUI: true
            };

            $scope.map = new google.maps.Map(document.querySelector("#map"), $scope.mapOptions);

            navigator.geolocation.getCurrentPosition(function (position) {
                $scope.map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
                $scope.marker = new google.maps.Marker({
                    position: $scope.map.getCenter(),
                    map: $scope.map,
                    icon: $scope.image
                });
            });
        } else {
            //throw exception
        }
    };

    angular.module("geofeelings").controller("mainController", ["$scope", mainController]);
})();
/**
 * Created by Jonatan on 21/12/2015.
 */

(function () {
    "use strict";

    var meController = function ($scope, $http, $location, profileService, shareService, eventService) {
        profileService.getUser(function (err, user) {
            if (!err) {
                if (user.redirect) {
                    $location.path(user.redirect);
                } else {
                    $scope.user = user;
                    $scope.user.address1 = splitAddress(user.address, 0);
                    $scope.user.address2 = splitAddress(user.address, 1);

                    shareService.getSharesByUserId(user.id, function (err, shares) {
                        if(!err) {
                            if(shares.redirect) {
                                $location.path(shares.redirect);
                            } else {
                                angular.forEach(shares, function(share){
                                    if(share.eventid) {
                                        eventService.getEventById(share.eventid, function (err, event) {
                                            share.address = event.eventname;
                                        });
                                    } else {

                                    }
                                });

                                $scope.shares = shares;
                            }
                        } else {
                            console.log("> error shareService: " + err);
                        }
                    });
                }
            } else {
                console.log("> error profileService: " + err);
            }
        });

        $scope.save = function (user) {
            user.address = makeAddress(user.address1, user.address2);
            profileService.saveUser(user, function(err, data) {
                if(!err) {
                    if (data.redirect) {
                        $location.path(data.redirect);
                    } else {
                        $scope.user = data;
                        $scope.user.address1 = splitAddress(data.address, 0);
                        $scope.user.address2 = splitAddress(data.address, 1);
                    }
                } else {
                    console.log("> error: " + err);
                }
            });
        };

        $scope.logout = function () {
            profileService.logout().then(function (data) {
                $location.path(data);
            });
        };

        var splitAddress = function (address, part) {
            var split = address.split(",");
            return split[part];
        };

        var makeAddress = function (address1, address2) {
            return address1 + "," + address2;
        };
    };

    angular.module("geofeelings").controller("meController", ["$scope", "$http", "$location", "profileService", "shareService", "eventService", meController]);
})();
/**
 * Created by Jonatan on 1/12/2015.
 */

(function () {
    "use strict";

    var userController = function ($scope, $location, searchService, shareService, $routeParams) {

        $scope.init = function () {
            var userid = $routeParams.param;
            searchService.searchUserFromId(userid).then(userFoundWithId);
            shareService.getSharesByUserId(userid).then(sharesFoundWithId); //IMPLEMENTEREN ALS JONATAN DE API FTIE HEEFT AANGEMAAKT
        };

        var userFoundWithId = function (res) {
            $scope.userfoundwithid = res;

            if (res.lat !== undefined && res.lat !== undefined) {
                $scope.map.setCenter(new google.maps.LatLng(res.lat, res.lng));
                if ($scope.marker !== undefined) {
                    $scope.marker.setMap(null); //verwijdert alle markers eerst
                }
                $scope.marker = new google.maps.Marker({
                    position: {lat: res.lat, lng: res.lng},
                    map: $scope.map,
                    icon: $scope.image
                });
            }
        };



        $scope.test = function(share)
        {
            $scope.map.setCenter(new google.maps.LatLng(share.lat, share.lng));
            $scope.map.setZoom(19);
        };

        var giveFeelingsImageArrayNumber = function (res) {
            if (res.mood > 80) {
                return 4;
            }
            else {
                return Math.round(res.mood / 20);
            }
        };

        var sharesFoundWithId = function (res) {
            $scope.shareFoundWithUserId = res;

            //markers plaatsen en kaart verplaatsen naar hun gemiddelde
            var minLat = 100,
                maxLat = 0,
                minLng = 100,
                maxLng = 0,
                teller = 0,
                gemLat = 0,
                gemLng = 0;

            $scope.marker.setMap(null); //verwijdert alle markers eerst

            var feelingImages = ["depressed", "sad", "common", "happy", "excited"];

            res.forEach(function (res) {

                teller++;
                if (res.lat < minLat) {
                    minLat = res.lat;
                }
                if (res.lat > maxLat) {
                    maxLat = res.lat;
                }

                if (res.lng < minLng) {
                    minLng = res.lng;
                }
                if (res.lng > maxLng) {
                    maxLng = res.lng;
                }

                res.moodImageSource = "./assets/" + feelingImages[giveFeelingsImageArrayNumber(res)] + ".png";

                $scope.marker = new google.maps.Marker({
                    position: {lat: res.lat, lng: res.lng},
                    map: $scope.map,
                    icon: res.moodImageSource
                });
            });

            if (teller == 1) {
                gemLat = res[0].lat;
                gemLng = res[0].lng;
            }
            else {
                gemLat = ((maxLat - minLat) / 2) + minLat;
                gemLng = ((maxLng - minLng) / 2) + minLng;
            }

            $scope.map.setCenter(new google.maps.LatLng(gemLat, gemLng));
            $scope.map.setZoom(14);
            //klaar met markers plaatsen en kaart verplaatsen naar hun gemiddelde
        };
    };

    angular.module("geofeelings").controller("userController", ["$scope", "$location", "searchService","shareService","$routeParams", userController]);
})
();
/**
 * Created by Jonatan on 28/12/2015.
 */

var eventService = function ($http) {
    "use strict";

    //private

    //public
    return {
        getEventById : function (eventid, cb) {
            $http.get("/api/event/" + eventid).success(function (data) {
                if(data.redirect) {
                    cb(null, data);
                } else {
                    cb(null, new GfEvent(data._id, data.eventname, data.eventimage, data.authorid, data.from, data.until, data.lat, data.lng, data.address));
                }
                cb(null, data);
            }).error(function (error) {
                cb(error, null);
            });
        }
    };
};

angular.module("geofeelings").factory("eventService", ["$http", "googleMapsService", eventService]);
/**
 * Created by Jonatan on 22/12/2015.
 */

// https://developers.google.com/maps/documentation/geocoding/intro?csw=1#Geocoding
// Dit gebruiken om adressen te vertalen naar lat en lng of omgekeerd
// Waarom? => google maps werkt met lat en lng, wordt zo opgeslaan in de database

var googleMapsService = function () {
    "use strict";
    // private
    var geocoder = new google.maps.Geocoder();

    //public
    return {
        showLocationOnMap: function (lat, lng) {

        },

        convertAdressToCoordinates: function (address, cb) {
            geocoder.geocode({address: address}, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    cb(null, results[0].geometry.location);
                } else {
                    cb(status, null);
                }
            });
        },

        convertCoordinatesToAdress: function (lat, lng, cb) {
            var location = new google.maps.LatLng(lat, lng);
            geocoder.geocode({latLng: location}, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    cb(null, results[0].formatted_address);
                } else if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
                    setTimeout(function(){
                        cb(null, results[0].formatted_address);
                    }, 200);
                } else {
                    cb(status, null);
                }
            });
        }
    };
};

angular.module("geofeelings").factory("googleMapsService", [googleMapsService]);
/**
 * Created by Jonatan on 27/12/2015.
 */

var profileService = function ($http, googleMapsService) {
    "use strict";

    // private

    //public
    return {
        getUser : function (cb) {
            $http.get("/auth/user").success(function (data) {
                if(data.redirect) {
                    cb(null, data);
                } else {
                    cb(null, new GfUser(data._id, data.username, data.email, data.userimage, new Date(data.age), data.lat, data.lng, data.address, data.chat, data.admin));
                }
            }).error(function (error) {
                cb(error, null);
            });
        },

        saveUser : function (user, cb) {
            googleMapsService.convertAdressToCoordinates(user.address, function(err, coord) {
                if(!err) {
                    user.lat = coord.lat();
                    user.lng = coord.lng();

                    $http.put("/api/user/" + user.id, user).success(function (data) {
                        if(data.redirect) {
                            cb(null, data);
                        } else {
                            cb(null, new GfUser(data._id, data.username, data.email, data.userimage, new Date(data.age), data.lat, data.lng, data.address, data.chat, data.admin));
                        }
                    }).error(function (error) {
                        cb(error, null);
                    });
                } else {
                    cb(err, null);
                }
            });
        },

        logout : function () {
            return $http.get("/auth/logout").then(function (data) {
                return data;
            });
        }
    };
};

angular.module("geofeelings").factory("profileService", ["$http", "googleMapsService", profileService]);
(function () {
    "use strict";

    var searchService = function ($http) {

        var search = function (searchString) {
            var url = 'http://localhost:3000/api/user/';

            return $http.get(url).then(function (response) {

                var arSearchResults = [];
                angular.forEach(response.data, function (searchR) {
                    var newSR = new SearchResult(searchR._id, searchR.username);
                    arSearchResults.push(newSR);
                });
                return arSearchResults;
            });
        };

        var searchUserFromId = function (searchString) {
            var url = 'http://localhost:3000/api/user/' + searchString;
            return $http.get(url).then(function (response) {
                return new GfUser(
                    response.data._id,
                    response.data.username,
                    response.data.email,
                    response.data.userimage,
                    response.data.age,
                    response.data.lat,
                    response.data.lng,
                    response.data.chat,
                    response.data.admin
                );

            });
        };

        return {
            search: search,
            searchUserFromId: searchUserFromId
        };
    };
    angular.module("geofeelings").factory("searchService", ["$http", searchService]);
})();
/**
 * Created by Lienert on 23/12/2015.
 */

/**
 * OPMERKING
 * post share zal niet werken
 * implementeer googleService
 * voorbeeld kan je vinden in profileservice (post functie)
 * Groetjes Jonatan
 */


var shareService = function ($http, $location, googleMapsService, shareVarsBetweenCtrl) {
    "use strict";

    //private
    var makeAddress = function (address) {
        var split = address.split(",");
        return split[0] + ", " + split[1];
    };

    var postShare = function (data) {
        $http({
            url: 'http://localhost:3000/api/share',
            method: 'POST',
            data: data,
            headers: {'Content-Type': 'application/json'}
        }).
        success(function (serverData) {
            shareVarsBetweenCtrl.setProperty(serverData); //data kunnen doorgeven aan intro_sharedController
            $location.path("intro_shared");
        });
    };

    //public
    return {
        postShare: postShare,
        getSharesByUserId: function (userid, cb) {
            $http.get("/api/share/" + userid).success(function (data) {
                if(data.redirect) {
                    cb(null, data);
                } else {
                    var shares = [];
                    angular.forEach(data, function(share) {
                        shares.push(new GfShare(share._id, share.userid, share.eventid, share.time, share.mood, share.lat, share.lng, makeAddress(share.address)));
                    });
                    cb(null, shares);
                }
            }).error(function (error) {
                cb(error, null);
            });
        }
    };
};
angular.module("geofeelings").factory("shareService", ["$http", "$location", "googleMapsService", "shareVarsBetweenCtrl", shareService]);

/**
 * Created by liene on 28/12/2015.
 */


var shareVarsBetweenCtrl = function () {
    "use strict";

    //private
    var property;
    var userlessShare;

    //public
    return {

        getProperty: function () {
            return property;
        },

        setProperty: function (value) {
            property = value;
        },

        saveUserlessShare: function (data) {
            userlessShare = data;
        },
        returnUserlessShare: function () {
            return userlessShare;
        }
    };
};

angular.module("geofeelings").factory("shareVarsBetweenCtrl", [shareVarsBetweenCtrl]);
/**
 * Created by Jonatan on 28/12/2015.
 */

function GfEvent(id, eventname, eventimage, authorid, from, until, lat, lng, address) {
    this.id = id;
    this.eventname = eventname;
    this.eventimage = eventimage;
    this.authorid = authorid;
    this.from = from;
    this.until = until;
    this.lat = lat;
    this.lng = lng;
    this.address = address;
}

GfShare.prototype.toString = function () {
    return this.eventname;
};
function GfShare(id, userid, eventid, time, mood, lat, lng, address) {
    this.id = id;
    this.userid = userid;
    this.eventid = eventid;
    this.time = time;
    this.mood = mood;
    this.lat = lat;
    this.lng = lng;
    this.address = address;
}

GfShare.prototype.toString = function () {
    return this.userid + " (" + this.time + ")";
};

function GfUser(id, username, email, userimage, age, lat, lng, address, chat, admin) {
    this.id = id;
    this.username = username;
    this.email = email;
    this.userimage = userimage;
    this.age = age;
    this.lat = lat;
    this.lng = lng;
    this.address = address;
    this.chat = chat;
    this.admin = admin;
}

GfUser.prototype.toString = function () {
    return this.username;
};

function SearchResult(id,username)
{
    this.id = id;
    this.username = username;
}
SearchResult.prototype.toString = function() {
    return this.title;
};

/**
 * Created by Jonatan on 22/11/2015.
 */

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImV2ZW50Q29udHJvbGxlci9ldmVudENvbnRyb2xsZXIuanMiLCJhZG1pbkNvbnRyb2xsZXIvYWRtaW5Db250cm9sbGVyLmpzIiwiaW50cm9Db250cm9sbGVyL2ludHJvQ29udHJvbGxlci5qcyIsImludHJvQ29udHJvbGxlci9pbnRyb19zaGFyZWRDb250cm9sbGVyLmpzIiwibG9jYXRpb25Db250cm9sbGVyL2xvY2F0aW9uQ29udHJvbGxlci5qcyIsImxvZ2luQ29udHJvbGxlci9sb2dpbkNvbnRyb2xsZXIuanMiLCJzZWFyY2hDb250cm9sbGVyL3NlYXJjaENvbnRyb2xsZXIuanMiLCJtYWluQ29udHJvbGxlci9tYWluQ29udHJvbGxlci5qcyIsInVzZXJDb250cm9sbGVyL21lQ29udHJvbGxlci5qcyIsInVzZXJDb250cm9sbGVyL3VzZXJDb250cm9sbGVyLmpzIiwiZXZlbnRTZXJ2aWNlLmpzIiwiZ29vZ2xlTWFwc1NlcnZpY2UuanMiLCJwcm9maWxlU2VydmljZS5qcyIsInNlYXJjaFNlcnZpY2UuanMiLCJzaGFyZVNlcnZpY2UuanMiLCJzaGFyZVZhcnNCZXR3ZWVuQ3RybHMuanMiLCJnZkV2ZW50LmpzIiwiZ2ZTaGFyZS5qcyIsImdmVXNlci5qcyIsIlNlYXJjaFJlc3VsdC5qcyIsIm1hcEV4Y2VwdGlvbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIiwgW1wibmdSb3V0ZVwiXSk7XHJcblxyXG4gICAgYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIpIHtcclxuICAgICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbihcIi9hZG1pblwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL2FkbWluQ29udHJvbGxlci9hZG1pbi5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9zZWFyY2hcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9zZWFyY2hDb250cm9sbGVyL3NlYXJjaC5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9pbnRyb1wiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL2ludHJvQ29udHJvbGxlci9pbnRyby5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9oZWxwXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vZGlyZWN0aXZlcy9oZWxwLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2xvZ2luXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvbG9naW5Db250cm9sbGVyL2xvZ2luLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL3JlZ2lzdGVyXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvbG9naW5Db250cm9sbGVyL3JlZ2lzdGVyLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL3Bhc3N3b3JkXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvbG9naW5Db250cm9sbGVyL3Bhc3N3b3JkLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL3VzZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy91c2VyQ29udHJvbGxlci91c2VyLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL3VzZXIvOnBhcmFtXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvdXNlckNvbnRyb2xsZXIvdXNlci5odG1sXCIsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAndXNlckNvbnRyb2xsZXInXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvbWVcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy91c2VyQ29udHJvbGxlci9tZS5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9ldmVudFwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL2V2ZW50Q29udHJvbGxlci9ldmVudC5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9hZGRFdmVudFwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL2V2ZW50Q29udHJvbGxlci9hZGRFdmVudC5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9sb2NhdGlvblwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL2xvY2F0aW9uQ29udHJvbGxlci9sb2NhdGlvbi5odG1sXCJcclxuICAgICAgICAgICAgfSkud2hlbihcIi9pbnRyb19zaGFyZWRcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9pbnRyb0NvbnRyb2xsZXIvaW50cm9fc2hhcmVkLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS5vdGhlcndpc2Uoe1xyXG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUbzogXCIvaW50cm9cIlxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFwcC5kaXJlY3RpdmUoXCJzZWFyY2hyZXN1bHRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZGlyZWN0aXZlcy9zZWFyY2hSZXN1bHQuaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLnNlcnZpY2UoJ3NoYXJlZFByb3BlcnRpZXMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHByb3BlcnR5ID0gJ0ZpcnN0JztcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0UHJvcGVydHk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UHJvcGVydHk6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gNC8xMi8yMDE1LlxyXG4gKi9cclxuXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGV2ZW50Q29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImV2ZW50Q29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgZXZlbnRDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiA2LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBhZG1pbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmNvbnRyb2xsZXIoXCJhZG1pbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIGFkbWluQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgaW50cm9Db250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgc2hhcmVTZXJ2aWNlLCAkaHR0cCwgJGxvY2F0aW9uLCBwcm9maWxlU2VydmljZSxzaGFyZVZhcnNCZXR3ZWVuQ3RybCkge1xyXG5cclxuXHJcbiAgICAgICAgLy9TTUlMRVkgVEVLRU5FTlxyXG4gICAgICAgICRzY29wZS5zbGlkZXJWYWx1ZSA9IDUwO1xyXG4gICAgICAgICRzY29wZS5tb29kV29yZCA9IG51bGw7XHJcbiAgICAgICAgdmFyIGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNtaWxleUNhbnZhc1wiKTtcclxuICAgICAgICB2YXIgY3R4ID0gYy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgICAgIHZhciBzYWRSR0IgPSBbMTUyLCAzMCwgMzBdO1xyXG4gICAgICAgIHZhciBoYXBweVJHQiA9IFs3MCwgMTYxLCA3M107XHJcblxyXG4gICAgICAgIC8vdGVsa2VucyBzbGlkZXJ2YWx1ZSB2ZXJhbmRlcnQgZ2V6aWNodGplIHRla2VuZW5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKFwic2xpZGVyVmFsdWVcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGMud2lkdGgsIGMuaGVpZ2h0KTsgLy9jYW52YXMgY2xlYXJlbiB2b29yIG5pZXV3IGZyYW1lXHJcblxyXG4gICAgICAgICAgICB2YXIgbW9vZCA9ICRzY29wZS5zbGlkZXJWYWx1ZTtcclxuICAgICAgICAgICAgZ2l2ZU1vb2RXb3JkKCk7XHJcbiAgICAgICAgICAgIC8vb2Zmc2V0IHBvc2l0aWUgbW9uZFxyXG4gICAgICAgICAgICB2YXIgb2Zmc2V0WCA9IGMud2lkdGggLyA1O1xyXG4gICAgICAgICAgICB2YXIgb2ZmU2V0WSA9IGMud2lkdGggLyAyLjE0ICsgKG1vb2QgLyAoYy53aWR0aCAvIDYpKTtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyaWFiZWxlbiB2b29yIGJlemllcmN1cnZlICg9IG1vbmQpXHJcbiAgICAgICAgICAgIHZhciBTUHggPSBvZmZzZXRYO1xyXG4gICAgICAgICAgICB2YXIgU1B5ID0gb2ZmU2V0WSArIGMud2lkdGggLyAzIC0gKG1vb2QgKiAoYy53aWR0aCAvIDM3Ni42NikpO1xyXG4gICAgICAgICAgICB2YXIgSDF4ID0gb2Zmc2V0WDtcclxuICAgICAgICAgICAgdmFyIEgxeSA9IG9mZlNldFkgKyAobW9vZCAqIChjLndpZHRoIC8gMjUwKSk7XHJcbiAgICAgICAgICAgIHZhciBIMnggPSBvZmZzZXRYICsgKChjLndpZHRoIC8gMzAwKSAqIDE4MCk7XHJcbiAgICAgICAgICAgIHZhciBIMnkgPSBvZmZTZXRZICsgKG1vb2QgKiAoYy53aWR0aCAvIDI1MCkpO1xyXG4gICAgICAgICAgICB2YXIgRVB4ID0gb2Zmc2V0WCArIChjLndpZHRoIC8gMS42NjYpO1xyXG4gICAgICAgICAgICB2YXIgRVB5ID0gb2ZmU2V0WSArIChjLndpZHRoIC8gMykgLSAobW9vZCAqIChjLndpZHRoIC8gMzc2LjY2KSk7XHJcblxyXG4gICAgICAgICAgICAvL2hvb2ZkXHJcbiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBjLndpZHRoIC8gNjA7XHJcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgY3R4LmFyYygoYy53aWR0aCAvIDIpLCAoYy53aWR0aCAvIDIpLCAoYy53aWR0aCAvIDIuMDcpLCAwLCAyICogTWF0aC5QSSk7XHJcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYihcIiArIG1vb2RDb2xvcigwKSArIFwiLFwiICsgbW9vZENvbG9yKDEpICsgXCIsXCIgKyBtb29kQ29sb3IoMikgKyBcIilcIjtcclxuICAgICAgICAgICAgY3R4LmZpbGwoKTtcclxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3doaXRlJztcclxuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG5cclxuICAgICAgICAgICAgLy9tb25kXHJcblxyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYy53aWR0aCAvIDMwO1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oU1B4LCBTUHkpO1xyXG4gICAgICAgICAgICBjdHguYmV6aWVyQ3VydmVUbyhIMXgsIEgxeSwgSDJ4LCBIMnksIEVQeCwgRVB5KTtcclxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ2JsYWNrJztcclxuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICBjdHgubGluZUNhcCA9IFwicm91bmRcIjtcclxuXHJcbiAgICAgICAgICAgIC8vb29nIGxpbmtzXHJcblxyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYy53aWR0aCAvIDYwO1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5hcmMoYy53aWR0aCAvIDMsIGMud2lkdGggLyAzLCBjLndpZHRoIC8gMTUsIDAsIDIgKiBNYXRoLlBJKTtcclxuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7XHJcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XHJcbiAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuXHJcbiAgICAgICAgICAgIC8vb29nIHJlY2h0c1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5hcmMoYy53aWR0aCAvIDMgKiAyLCBjLndpZHRoIC8gMywgYy53aWR0aCAvIDE1LCAwLCAyICogTWF0aC5QSSk7XHJcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgICAgICAgICBjdHguZmlsbCgpO1xyXG4gICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBtb29kQ29sb3IgPSBmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAvL2M6IFIgPSAwLCBHID0gMSwgQiA9IDJcclxuXHJcbiAgICAgICAgICAgIGlmIChzYWRSR0JbY10gPiBoYXBweVJHQltjXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoc2FkUkdCW2NdIC0gKChzYWRSR0JbY10gLSBoYXBweVJHQltjXSkgKiAoJHNjb3BlLnNsaWRlclZhbHVlIC8gMTAwKSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoc2FkUkdCW2NdICsgKChoYXBweVJHQltjXSAtIHNhZFJHQltjXSkgKiAoJHNjb3BlLnNsaWRlclZhbHVlIC8gMTAwKSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBtb29kd29yZHMgPSBbXCJob3JyaWJsZVwiLCBcInJlYWxseSBiYWRcIiwgXCJiYWRcIiwgXCJva2F5XCIsIFwiZ29vZFwiLCBcInJlYWxseSBnb29kXCIsIFwiZXhjZWxsZW50XCJdO1xyXG5cclxuICAgICAgICB2YXIgZ2l2ZU1vb2RXb3JkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgNSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5zbGlkZXJWYWx1ZSA8IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubW9vZFdvcmQgPSBtb29kd29yZHNbMV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgNDApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1syXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICgkc2NvcGUuc2xpZGVyVmFsdWUgPCA2MCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzNdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5zbGlkZXJWYWx1ZSA8IDc1KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubW9vZFdvcmQgPSBtb29kd29yZHNbNF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgOTUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1s1XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1s2XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRodHRwLmdldCgnL2F1dGgvdXNlcicpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICRzY29wZS5zaGFyZVBvc3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5wb3N0U2hhcmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zaGFyZVBvc3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldFVzZXIoZnVuY3Rpb24gKGVyciwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5yZWRpcmVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJsZXNzU2hhcmVEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcmlkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJldmVudGlkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aW1lXCI6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1vb2RcIjogJHNjb3BlLnNsaWRlclZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGF0XCI6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxuZ1wiOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlVmFyc0JldHdlZW5DdHJsLnNhdmVVc2VybGVzc1NoYXJlKHVzZXJsZXNzU2hhcmVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyaWRcIjogJHNjb3BlLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZXZlbnRpZFwiOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGltZVwiOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb29kXCI6ICRzY29wZS5zbGlkZXJWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhdFwiOiBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsbmdcIjogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlU2VydmljZS5wb3N0U2hhcmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvcjogXCIgKyBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmNvbnRyb2xsZXIoXCJpbnRyb0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic2hhcmVTZXJ2aWNlXCIsIFwiJGh0dHBcIiwgXCIkbG9jYXRpb25cIiwgXCJwcm9maWxlU2VydmljZVwiLFwic2hhcmVWYXJzQmV0d2VlbkN0cmxcIiwgaW50cm9Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTGllbmVydCBvbiAyMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgaW50cm9fc2hhcmVkQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsIHNoYXJlVmFyc0JldHdlZW5DdHJsLHByb2ZpbGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgJHNjb3BlLmluZm9Qb3N0ZWRTaGFyZSA9IHNoYXJlVmFyc0JldHdlZW5DdHJsLmdldFByb3BlcnR5KCkuc2hhcmU7XHJcbiAgICB9O1xyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwiaW50cm9fc2hhcmVkQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzaGFyZVZhcnNCZXR3ZWVuQ3RybFwiLFwicHJvZmlsZVNlcnZpY2VcIiwgaW50cm9fc2hhcmVkQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gNi8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgbG9jYXRpb25Db250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSkge1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwibG9jYXRpb25Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBsb2NhdGlvbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDI2LzExLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBsb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBzaGFyZVZhcnNCZXR3ZWVuQ3RybCwgc2hhcmVTZXJ2aWNlLCBwcm9maWxlU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIgcG9zdFVzZXJsZXNzU2hhcmUgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgc2hhcmVEYXRhID0gc2hhcmVWYXJzQmV0d2VlbkN0cmwucmV0dXJuVXNlcmxlc3NTaGFyZSgpO1xyXG4gICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRVc2VyKGZ1bmN0aW9uIChlcnIsIHVzZXIpIHtcclxuICAgICAgICAgICAgICAgIGlmICghZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgodXNlci5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVEYXRhLnVzZXJpZCA9IHVzZXIuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlU2VydmljZS5wb3N0U2hhcmUoc2hhcmVEYXRhKTsgLy9wb3N0IGRlIHNoYXJlIG1ldCBkZSBpbmxvZ2RhdGEgZGF0IGhpaiBudSB3ZWV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlVmFyc0JldHdlZW5DdHJsLnNhdmVVc2VybGVzc1NoYXJlKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCI+IGVycm9yIHByb2ZpbGVTZXJ2aWNlOiBcIiArIGVycik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL2F1dGgvbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS5wYXNzd29yZFxyXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNoYXJlVmFyc0JldHdlZW5DdHJsLnJldHVyblVzZXJsZXNzU2hhcmUoKSAhPT0gdW5kZWZpbmVkICYmIHNoYXJlVmFyc0JldHdlZW5DdHJsLnJldHVyblVzZXJsZXNzU2hhcmUoKSAhPT0gXCJcIikgLy91c2VyIGhlZWZ0IHdpbGxlbiBzaGFyZW4sIG1hYXIgd2FzIG5pZXQgaW5nZWxvZ2QuXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zdFVzZXJsZXNzU2hhcmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hdXRoL3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICRzY29wZS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAkc2NvcGUucGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBlbWFpbDogJHNjb3BlLmVtYWlsXHJcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGRhdGEuZXJyb3I7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hhcmVWYXJzQmV0d2VlbkN0cmwucmV0dXJuVXNlcmxlc3NTaGFyZSgpICE9PSB1bmRlZmluZWQgJiYgc2hhcmVWYXJzQmV0d2VlbkN0cmwucmV0dXJuVXNlcmxlc3NTaGFyZSgpICE9PSBcIlwiKSAvL3VzZXIgaGVlZnQgd2lsbGVuIHNoYXJlbiwgbWFhciB3YXMgbmlldCBpbmdlbG9nZC5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwb3N0VXNlcmxlc3NTaGFyZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRsb2NhdGlvblwiLCBcInNoYXJlVmFyc0JldHdlZW5DdHJsXCIsIFwic2hhcmVTZXJ2aWNlXCIsIFwicHJvZmlsZVNlcnZpY2VcIiwgbG9naW5Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiAyNS8xMS8yMDE1LlxyXG4gKi9cclxuXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIHNlYXJjaENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCBzZWFyY2hTZXJ2aWNlLCBzaGFyZWRQcm9wZXJ0aWVzKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5zZWFyY2hNb2RlbCA9IG51bGw7XHJcblxyXG4gICAgICAgICRzY29wZS5zZWFyY2hPblN1Ym1pdCA9IGZ1bmN0aW9uIChmb3JtT2JqKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoTW9kZWwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoTm93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5zZWFyY2hPbktleVByZXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNlYXJjaE1vZGVsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hOb3coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5maWx0ZXJTZWFyY2hSZXN1bHRzID0gZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zZWFyY2hNb2RlbCA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaS51c2VybmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJHNjb3BlLnNlYXJjaE1vZGVsLnRvTG9jYWxlTG93ZXJDYXNlKCkpID49IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpLmRlc2NyaXB0aW9uLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigkc2NvcGUuc2VhcmNoTW9kZWwudG9Mb2NhbGVMb3dlckNhc2UoKSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHZhciBzZWFyY2hOb3cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaFNlcnZpY2Uuc2VhcmNoKCRzY29wZS5zZWFyY2hNb2RlbCkudGhlbihvblJlc3VsdHNSZWFkeSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG9uUmVzdWx0c1JlYWR5ID0gZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoUmVzdWx0cyA9IHJlcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgb25SZXN1bHRzRXJyb3IgPSBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwic2VhcmNoQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCJzZWFyY2hTZXJ2aWNlXCIsXCJzaGFyZWRQcm9wZXJ0aWVzXCIsIHNlYXJjaENvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIxLzExLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBtYWluQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pbWFnZSA9IFwiLi9hc3NldHMvbG9jYXRpb25fbm93LnBuZ1wiO1xyXG4gICAgICAgICAgICAkc2NvcGUubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHpvb206IDE1LFxyXG4gICAgICAgICAgICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUCxcclxuICAgICAgICAgICAgICAgIGRpc2FibGVEZWZhdWx0VUk6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFwXCIpLCAkc2NvcGUubWFwT3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsIHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJHNjb3BlLm1hcC5nZXRDZW50ZXIoKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJHNjb3BlLmltYWdlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy90aHJvdyBleGNlcHRpb25cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcIm1haW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBtYWluQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMjEvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIG1lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sIHByb2ZpbGVTZXJ2aWNlLCBzaGFyZVNlcnZpY2UsIGV2ZW50U2VydmljZSkge1xyXG4gICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldFVzZXIoZnVuY3Rpb24gKGVyciwgdXNlcikge1xyXG4gICAgICAgICAgICBpZiAoIWVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXIucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCh1c2VyLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmFkZHJlc3MxID0gc3BsaXRBZGRyZXNzKHVzZXIuYWRkcmVzcywgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuYWRkcmVzczIgPSBzcGxpdEFkZHJlc3ModXNlci5hZGRyZXNzLCAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2hhcmVTZXJ2aWNlLmdldFNoYXJlc0J5VXNlcklkKHVzZXIuaWQsIGZ1bmN0aW9uIChlcnIsIHNoYXJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZighZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzaGFyZXMucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChzaGFyZXMucmVkaXJlY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goc2hhcmVzLCBmdW5jdGlvbihzaGFyZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNoYXJlLmV2ZW50aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2VydmljZS5nZXRFdmVudEJ5SWQoc2hhcmUuZXZlbnRpZCwgZnVuY3Rpb24gKGVyciwgZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZS5hZGRyZXNzID0gZXZlbnQuZXZlbnRuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zaGFyZXMgPSBzaGFyZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj4gZXJyb3Igc2hhcmVTZXJ2aWNlOiBcIiArIGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPiBlcnJvciBwcm9maWxlU2VydmljZTogXCIgKyBlcnIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgdXNlci5hZGRyZXNzID0gbWFrZUFkZHJlc3ModXNlci5hZGRyZXNzMSwgdXNlci5hZGRyZXNzMik7XHJcbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLnNhdmVVc2VyKHVzZXIsIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYoIWVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnJlZGlyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGRhdGEucmVkaXJlY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuYWRkcmVzczEgPSBzcGxpdEFkZHJlc3MoZGF0YS5hZGRyZXNzLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuYWRkcmVzczIgPSBzcGxpdEFkZHJlc3MoZGF0YS5hZGRyZXNzLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPiBlcnJvcjogXCIgKyBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBwcm9maWxlU2VydmljZS5sb2dvdXQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNwbGl0QWRkcmVzcyA9IGZ1bmN0aW9uIChhZGRyZXNzLCBwYXJ0KSB7XHJcbiAgICAgICAgICAgIHZhciBzcGxpdCA9IGFkZHJlc3Muc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gc3BsaXRbcGFydF07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG1ha2VBZGRyZXNzID0gZnVuY3Rpb24gKGFkZHJlc3MxLCBhZGRyZXNzMikge1xyXG4gICAgICAgICAgICByZXR1cm4gYWRkcmVzczEgKyBcIixcIiArIGFkZHJlc3MyO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcIm1lQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRsb2NhdGlvblwiLCBcInByb2ZpbGVTZXJ2aWNlXCIsIFwic2hhcmVTZXJ2aWNlXCIsIFwiZXZlbnRTZXJ2aWNlXCIsIG1lQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgdXNlckNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIHNlYXJjaFNlcnZpY2UsIHNoYXJlU2VydmljZSwgJHJvdXRlUGFyYW1zKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdXNlcmlkID0gJHJvdXRlUGFyYW1zLnBhcmFtO1xyXG4gICAgICAgICAgICBzZWFyY2hTZXJ2aWNlLnNlYXJjaFVzZXJGcm9tSWQodXNlcmlkKS50aGVuKHVzZXJGb3VuZFdpdGhJZCk7XHJcbiAgICAgICAgICAgIHNoYXJlU2VydmljZS5nZXRTaGFyZXNCeVVzZXJJZCh1c2VyaWQpLnRoZW4oc2hhcmVzRm91bmRXaXRoSWQpOyAvL0lNUExFTUVOVEVSRU4gQUxTIEpPTkFUQU4gREUgQVBJIEZUSUUgSEVFRlQgQUFOR0VNQUFLVFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1c2VyRm91bmRXaXRoSWQgPSBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyZm91bmR3aXRoaWQgPSByZXM7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzLmxhdCAhPT0gdW5kZWZpbmVkICYmIHJlcy5sYXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhyZXMubGF0LCByZXMubG5nKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1hcmtlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1hcmtlci5zZXRNYXAobnVsbCk7IC8vdmVyd2lqZGVydCBhbGxlIG1hcmtlcnMgZWVyc3RcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjoge2xhdDogcmVzLmxhdCwgbG5nOiByZXMubG5nfSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJHNjb3BlLmltYWdlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbihzaGFyZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgICRzY29wZS5tYXAuc2V0Q2VudGVyKG5ldyBnb29nbGUubWFwcy5MYXRMbmcoc2hhcmUubGF0LCBzaGFyZS5sbmcpKTtcclxuICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRab29tKDE5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2l2ZUZlZWxpbmdzSW1hZ2VBcnJheU51bWJlciA9IGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgaWYgKHJlcy5tb29kID4gODApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiA0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQocmVzLm1vb2QgLyAyMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2hhcmVzRm91bmRXaXRoSWQgPSBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zaGFyZUZvdW5kV2l0aFVzZXJJZCA9IHJlcztcclxuXHJcbiAgICAgICAgICAgIC8vbWFya2VycyBwbGFhdHNlbiBlbiBrYWFydCB2ZXJwbGFhdHNlbiBuYWFyIGh1biBnZW1pZGRlbGRlXHJcbiAgICAgICAgICAgIHZhciBtaW5MYXQgPSAxMDAsXHJcbiAgICAgICAgICAgICAgICBtYXhMYXQgPSAwLFxyXG4gICAgICAgICAgICAgICAgbWluTG5nID0gMTAwLFxyXG4gICAgICAgICAgICAgICAgbWF4TG5nID0gMCxcclxuICAgICAgICAgICAgICAgIHRlbGxlciA9IDAsXHJcbiAgICAgICAgICAgICAgICBnZW1MYXQgPSAwLFxyXG4gICAgICAgICAgICAgICAgZ2VtTG5nID0gMDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5tYXJrZXIuc2V0TWFwKG51bGwpOyAvL3ZlcndpamRlcnQgYWxsZSBtYXJrZXJzIGVlcnN0XHJcblxyXG4gICAgICAgICAgICB2YXIgZmVlbGluZ0ltYWdlcyA9IFtcImRlcHJlc3NlZFwiLCBcInNhZFwiLCBcImNvbW1vblwiLCBcImhhcHB5XCIsIFwiZXhjaXRlZFwiXTtcclxuXHJcbiAgICAgICAgICAgIHJlcy5mb3JFYWNoKGZ1bmN0aW9uIChyZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0ZWxsZXIrKztcclxuICAgICAgICAgICAgICAgIGlmIChyZXMubGF0IDwgbWluTGF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWluTGF0ID0gcmVzLmxhdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZXMubGF0ID4gbWF4TGF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4TGF0ID0gcmVzLmxhdDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLmxuZyA8IG1pbkxuZykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pbkxuZyA9IHJlcy5sbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLmxuZyA+IG1heExuZykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heExuZyA9IHJlcy5sbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzLm1vb2RJbWFnZVNvdXJjZSA9IFwiLi9hc3NldHMvXCIgKyBmZWVsaW5nSW1hZ2VzW2dpdmVGZWVsaW5nc0ltYWdlQXJyYXlOdW1iZXIocmVzKV0gKyBcIi5wbmdcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHtsYXQ6IHJlcy5sYXQsIGxuZzogcmVzLmxuZ30sXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiAkc2NvcGUubWFwLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHJlcy5tb29kSW1hZ2VTb3VyY2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0ZWxsZXIgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZ2VtTGF0ID0gcmVzWzBdLmxhdDtcclxuICAgICAgICAgICAgICAgIGdlbUxuZyA9IHJlc1swXS5sbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBnZW1MYXQgPSAoKG1heExhdCAtIG1pbkxhdCkgLyAyKSArIG1pbkxhdDtcclxuICAgICAgICAgICAgICAgIGdlbUxuZyA9ICgobWF4TG5nIC0gbWluTG5nKSAvIDIpICsgbWluTG5nO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUubWFwLnNldENlbnRlcihuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGdlbUxhdCwgZ2VtTG5nKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5tYXAuc2V0Wm9vbSgxNCk7XHJcbiAgICAgICAgICAgIC8va2xhYXIgbWV0IG1hcmtlcnMgcGxhYXRzZW4gZW4ga2FhcnQgdmVycGxhYXRzZW4gbmFhciBodW4gZ2VtaWRkZWxkZVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcInVzZXJDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRsb2NhdGlvblwiLCBcInNlYXJjaFNlcnZpY2VcIixcInNoYXJlU2VydmljZVwiLFwiJHJvdXRlUGFyYW1zXCIsIHVzZXJDb250cm9sbGVyXSk7XHJcbn0pXHJcbigpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMjgvMTIvMjAxNS5cclxuICovXHJcblxyXG52YXIgZXZlbnRTZXJ2aWNlID0gZnVuY3Rpb24gKCRodHRwKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICAvL3ByaXZhdGVcclxuXHJcbiAgICAvL3B1YmxpY1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBnZXRFdmVudEJ5SWQgOiBmdW5jdGlvbiAoZXZlbnRpZCwgY2IpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KFwiL2FwaS9ldmVudC9cIiArIGV2ZW50aWQpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmKGRhdGEucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IobnVsbCwgbmV3IEdmRXZlbnQoZGF0YS5faWQsIGRhdGEuZXZlbnRuYW1lLCBkYXRhLmV2ZW50aW1hZ2UsIGRhdGEuYXV0aG9yaWQsIGRhdGEuZnJvbSwgZGF0YS51bnRpbCwgZGF0YS5sYXQsIGRhdGEubG5nLCBkYXRhLmFkZHJlc3MpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNiKG51bGwsIGRhdGEpO1xyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNiKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuZmFjdG9yeShcImV2ZW50U2VydmljZVwiLCBbXCIkaHR0cFwiLCBcImdvb2dsZU1hcHNTZXJ2aWNlXCIsIGV2ZW50U2VydmljZV0pOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMjIvMTIvMjAxNS5cclxuICovXHJcblxyXG4vLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9tYXBzL2RvY3VtZW50YXRpb24vZ2VvY29kaW5nL2ludHJvP2Nzdz0xI0dlb2NvZGluZ1xyXG4vLyBEaXQgZ2VicnVpa2VuIG9tIGFkcmVzc2VuIHRlIHZlcnRhbGVuIG5hYXIgbGF0IGVuIGxuZyBvZiBvbWdla2VlcmRcclxuLy8gV2Fhcm9tPyA9PiBnb29nbGUgbWFwcyB3ZXJrdCBtZXQgbGF0IGVuIGxuZywgd29yZHQgem8gb3BnZXNsYWFuIGluIGRlIGRhdGFiYXNlXHJcblxyXG52YXIgZ29vZ2xlTWFwc1NlcnZpY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIC8vIHByaXZhdGVcclxuICAgIHZhciBnZW9jb2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcigpO1xyXG5cclxuICAgIC8vcHVibGljXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHNob3dMb2NhdGlvbk9uTWFwOiBmdW5jdGlvbiAobGF0LCBsbmcpIHtcclxuXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgY29udmVydEFkcmVzc1RvQ29vcmRpbmF0ZXM6IGZ1bmN0aW9uIChhZGRyZXNzLCBjYikge1xyXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKHthZGRyZXNzOiBhZGRyZXNzfSwgZnVuY3Rpb24gKHJlc3VsdHMsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSBnb29nbGUubWFwcy5HZW9jb2RlclN0YXR1cy5PSykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIHJlc3VsdHNbMF0uZ2VvbWV0cnkubG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihzdGF0dXMsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBjb252ZXJ0Q29vcmRpbmF0ZXNUb0FkcmVzczogZnVuY3Rpb24gKGxhdCwgbG5nLCBjYikge1xyXG4gICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxhdCwgbG5nKTtcclxuICAgICAgICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7bGF0TG5nOiBsb2NhdGlvbn0sIGZ1bmN0aW9uIChyZXN1bHRzLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCByZXN1bHRzWzBdLmZvcm1hdHRlZF9hZGRyZXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9WRVJfUVVFUllfTElNSVQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIHJlc3VsdHNbMF0uZm9ybWF0dGVkX2FkZHJlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKHN0YXR1cywgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn07XHJcblxyXG5hbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmZhY3RvcnkoXCJnb29nbGVNYXBzU2VydmljZVwiLCBbZ29vZ2xlTWFwc1NlcnZpY2VdKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDI3LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxudmFyIHByb2ZpbGVTZXJ2aWNlID0gZnVuY3Rpb24gKCRodHRwLCBnb29nbGVNYXBzU2VydmljZSkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgLy8gcHJpdmF0ZVxyXG5cclxuICAgIC8vcHVibGljXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGdldFVzZXIgOiBmdW5jdGlvbiAoY2IpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KFwiL2F1dGgvdXNlclwiKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLnJlZGlyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IobnVsbCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIG5ldyBHZlVzZXIoZGF0YS5faWQsIGRhdGEudXNlcm5hbWUsIGRhdGEuZW1haWwsIGRhdGEudXNlcmltYWdlLCBuZXcgRGF0ZShkYXRhLmFnZSksIGRhdGEubGF0LCBkYXRhLmxuZywgZGF0YS5hZGRyZXNzLCBkYXRhLmNoYXQsIGRhdGEuYWRtaW4pKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjYihlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNhdmVVc2VyIDogZnVuY3Rpb24gKHVzZXIsIGNiKSB7XHJcbiAgICAgICAgICAgIGdvb2dsZU1hcHNTZXJ2aWNlLmNvbnZlcnRBZHJlc3NUb0Nvb3JkaW5hdGVzKHVzZXIuYWRkcmVzcywgZnVuY3Rpb24oZXJyLCBjb29yZCkge1xyXG4gICAgICAgICAgICAgICAgaWYoIWVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXIubGF0ID0gY29vcmQubGF0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlci5sbmcgPSBjb29yZC5sbmcoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucHV0KFwiL2FwaS91c2VyL1wiICsgdXNlci5pZCwgdXNlcikuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLnJlZGlyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYihudWxsLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIG5ldyBHZlVzZXIoZGF0YS5faWQsIGRhdGEudXNlcm5hbWUsIGRhdGEuZW1haWwsIGRhdGEudXNlcmltYWdlLCBuZXcgRGF0ZShkYXRhLmFnZSksIGRhdGEubGF0LCBkYXRhLmxuZywgZGF0YS5hZGRyZXNzLCBkYXRhLmNoYXQsIGRhdGEuYWRtaW4pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYihlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKGVyciwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGxvZ291dCA6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChcIi9hdXRoL2xvZ291dFwiKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuZmFjdG9yeShcInByb2ZpbGVTZXJ2aWNlXCIsIFtcIiRodHRwXCIsIFwiZ29vZ2xlTWFwc1NlcnZpY2VcIiwgcHJvZmlsZVNlcnZpY2VdKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIHNlYXJjaFNlcnZpY2UgPSBmdW5jdGlvbiAoJGh0dHApIHtcclxuXHJcbiAgICAgICAgdmFyIHNlYXJjaCA9IGZ1bmN0aW9uIChzZWFyY2hTdHJpbmcpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3VzZXIvJztcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhclNlYXJjaFJlc3VsdHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyZXNwb25zZS5kYXRhLCBmdW5jdGlvbiAoc2VhcmNoUikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdTUiA9IG5ldyBTZWFyY2hSZXN1bHQoc2VhcmNoUi5faWQsIHNlYXJjaFIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFyU2VhcmNoUmVzdWx0cy5wdXNoKG5ld1NSKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyU2VhcmNoUmVzdWx0cztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNlYXJjaFVzZXJGcm9tSWQgPSBmdW5jdGlvbiAoc2VhcmNoU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS91c2VyLycgKyBzZWFyY2hTdHJpbmc7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBHZlVzZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudXNlcmltYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubGF0LFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubG5nLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuY2hhdCxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmFkbWluXHJcbiAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsXHJcbiAgICAgICAgICAgIHNlYXJjaFVzZXJGcm9tSWQ6IHNlYXJjaFVzZXJGcm9tSWRcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuZmFjdG9yeShcInNlYXJjaFNlcnZpY2VcIiwgW1wiJGh0dHBcIiwgc2VhcmNoU2VydmljZV0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IExpZW5lcnQgb24gMjMvMTIvMjAxNS5cclxuICovXHJcblxyXG4vKipcclxuICogT1BNRVJLSU5HXHJcbiAqIHBvc3Qgc2hhcmUgemFsIG5pZXQgd2Vya2VuXHJcbiAqIGltcGxlbWVudGVlciBnb29nbGVTZXJ2aWNlXHJcbiAqIHZvb3JiZWVsZCBrYW4gamUgdmluZGVuIGluIHByb2ZpbGVzZXJ2aWNlIChwb3N0IGZ1bmN0aWUpXHJcbiAqIEdyb2V0amVzIEpvbmF0YW5cclxuICovXHJcblxyXG5cclxudmFyIHNoYXJlU2VydmljZSA9IGZ1bmN0aW9uICgkaHR0cCwgJGxvY2F0aW9uLCBnb29nbGVNYXBzU2VydmljZSwgc2hhcmVWYXJzQmV0d2VlbkN0cmwpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIC8vcHJpdmF0ZVxyXG4gICAgdmFyIG1ha2VBZGRyZXNzID0gZnVuY3Rpb24gKGFkZHJlc3MpIHtcclxuICAgICAgICB2YXIgc3BsaXQgPSBhZGRyZXNzLnNwbGl0KFwiLFwiKTtcclxuICAgICAgICByZXR1cm4gc3BsaXRbMF0gKyBcIiwgXCIgKyBzcGxpdFsxXTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHBvc3RTaGFyZSA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3NoYXJlJyxcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nfVxyXG4gICAgICAgIH0pLlxyXG4gICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24gKHNlcnZlckRhdGEpIHtcclxuICAgICAgICAgICAgc2hhcmVWYXJzQmV0d2VlbkN0cmwuc2V0UHJvcGVydHkoc2VydmVyRGF0YSk7IC8vZGF0YSBrdW5uZW4gZG9vcmdldmVuIGFhbiBpbnRyb19zaGFyZWRDb250cm9sbGVyXHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiaW50cm9fc2hhcmVkXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL3B1YmxpY1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBwb3N0U2hhcmU6IHBvc3RTaGFyZSxcclxuICAgICAgICBnZXRTaGFyZXNCeVVzZXJJZDogZnVuY3Rpb24gKHVzZXJpZCwgY2IpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KFwiL2FwaS9zaGFyZS9cIiArIHVzZXJpZCkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYoZGF0YS5yZWRpcmVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hhcmVzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRhdGEsIGZ1bmN0aW9uKHNoYXJlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlcy5wdXNoKG5ldyBHZlNoYXJlKHNoYXJlLl9pZCwgc2hhcmUudXNlcmlkLCBzaGFyZS5ldmVudGlkLCBzaGFyZS50aW1lLCBzaGFyZS5tb29kLCBzaGFyZS5sYXQsIHNoYXJlLmxuZywgbWFrZUFkZHJlc3Moc2hhcmUuYWRkcmVzcykpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCBzaGFyZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNiKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5mYWN0b3J5KFwic2hhcmVTZXJ2aWNlXCIsIFtcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIFwiZ29vZ2xlTWFwc1NlcnZpY2VcIiwgXCJzaGFyZVZhcnNCZXR3ZWVuQ3RybFwiLCBzaGFyZVNlcnZpY2VdKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgbGllbmUgb24gMjgvMTIvMjAxNS5cclxuICovXHJcblxyXG5cclxudmFyIHNoYXJlVmFyc0JldHdlZW5DdHJsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgLy9wcml2YXRlXHJcbiAgICB2YXIgcHJvcGVydHk7XHJcbiAgICB2YXIgdXNlcmxlc3NTaGFyZTtcclxuXHJcbiAgICAvL3B1YmxpY1xyXG4gICAgcmV0dXJuIHtcclxuXHJcbiAgICAgICAgZ2V0UHJvcGVydHk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5O1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldFByb3BlcnR5OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgcHJvcGVydHkgPSB2YWx1ZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzYXZlVXNlcmxlc3NTaGFyZTogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdXNlcmxlc3NTaGFyZSA9IGRhdGE7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXR1cm5Vc2VybGVzc1NoYXJlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1c2VybGVzc1NoYXJlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn07XHJcblxyXG5hbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmZhY3RvcnkoXCJzaGFyZVZhcnNCZXR3ZWVuQ3RybFwiLCBbc2hhcmVWYXJzQmV0d2VlbkN0cmxdKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDI4LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuZnVuY3Rpb24gR2ZFdmVudChpZCwgZXZlbnRuYW1lLCBldmVudGltYWdlLCBhdXRob3JpZCwgZnJvbSwgdW50aWwsIGxhdCwgbG5nLCBhZGRyZXNzKSB7XHJcbiAgICB0aGlzLmlkID0gaWQ7XHJcbiAgICB0aGlzLmV2ZW50bmFtZSA9IGV2ZW50bmFtZTtcclxuICAgIHRoaXMuZXZlbnRpbWFnZSA9IGV2ZW50aW1hZ2U7XHJcbiAgICB0aGlzLmF1dGhvcmlkID0gYXV0aG9yaWQ7XHJcbiAgICB0aGlzLmZyb20gPSBmcm9tO1xyXG4gICAgdGhpcy51bnRpbCA9IHVudGlsO1xyXG4gICAgdGhpcy5sYXQgPSBsYXQ7XHJcbiAgICB0aGlzLmxuZyA9IGxuZztcclxuICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XHJcbn1cclxuXHJcbkdmU2hhcmUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZXZlbnRuYW1lO1xyXG59OyIsImZ1bmN0aW9uIEdmU2hhcmUoaWQsIHVzZXJpZCwgZXZlbnRpZCwgdGltZSwgbW9vZCwgbGF0LCBsbmcsIGFkZHJlc3MpIHtcclxuICAgIHRoaXMuaWQgPSBpZDtcclxuICAgIHRoaXMudXNlcmlkID0gdXNlcmlkO1xyXG4gICAgdGhpcy5ldmVudGlkID0gZXZlbnRpZDtcclxuICAgIHRoaXMudGltZSA9IHRpbWU7XHJcbiAgICB0aGlzLm1vb2QgPSBtb29kO1xyXG4gICAgdGhpcy5sYXQgPSBsYXQ7XHJcbiAgICB0aGlzLmxuZyA9IGxuZztcclxuICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XHJcbn1cclxuXHJcbkdmU2hhcmUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlcmlkICsgXCIgKFwiICsgdGhpcy50aW1lICsgXCIpXCI7XHJcbn07XHJcbiIsImZ1bmN0aW9uIEdmVXNlcihpZCwgdXNlcm5hbWUsIGVtYWlsLCB1c2VyaW1hZ2UsIGFnZSwgbGF0LCBsbmcsIGFkZHJlc3MsIGNoYXQsIGFkbWluKSB7XHJcbiAgICB0aGlzLmlkID0gaWQ7XHJcbiAgICB0aGlzLnVzZXJuYW1lID0gdXNlcm5hbWU7XHJcbiAgICB0aGlzLmVtYWlsID0gZW1haWw7XHJcbiAgICB0aGlzLnVzZXJpbWFnZSA9IHVzZXJpbWFnZTtcclxuICAgIHRoaXMuYWdlID0gYWdlO1xyXG4gICAgdGhpcy5sYXQgPSBsYXQ7XHJcbiAgICB0aGlzLmxuZyA9IGxuZztcclxuICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XHJcbiAgICB0aGlzLmNoYXQgPSBjaGF0O1xyXG4gICAgdGhpcy5hZG1pbiA9IGFkbWluO1xyXG59XHJcblxyXG5HZlVzZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlcm5hbWU7XHJcbn07XHJcbiIsImZ1bmN0aW9uIFNlYXJjaFJlc3VsdChpZCx1c2VybmFtZSlcclxue1xyXG4gICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xyXG59XHJcblNlYXJjaFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLnRpdGxlO1xyXG59O1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIyLzExLzIwMTUuXHJcbiAqL1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

(function () {
    "use strict";

    var app = angular.module("geofeelings", ["ngRoute"]);

    app.config(function ($routeProvider) {
        $routeProvider
            .when("/admin", {
                templateUrl: "./controllers/adminController/admin.html"
            }).when("/search", {
                templateUrl: "./controllers/searchController/search.html"
            }).when("/intro", {
                templateUrl: "./controllers/introController/intro.html"
            }).when("/help", {
                templateUrl: "./directives/help.html"
            }).when("/login", {
                templateUrl: "./controllers/loginController/login.html"
            }).when("/register", {
                templateUrl: "./controllers/loginController/register.html"
            }).when("/password", {
                templateUrl: "./controllers/loginController/password.html"
            }).when("/user", {
                templateUrl: "./controllers/userController/user.html"
            }).when("/user/:param", {
                templateUrl: "./controllers/userController/user.html",
                controller: 'userController'
            }).when("/me", {
                templateUrl: "./controllers/userController/me.html"
            }).when("/event", {
                templateUrl: "./controllers/eventController/event.html"
            }).when("/addEvent", {
                templateUrl: "./controllers/eventController/addEvent.html"
            }).when("/location", {
                templateUrl: "./controllers/locationController/location.html"
            }).when("/intro_shared", {
                templateUrl: "./controllers/introController/intro_shared.html"
            }).otherwise({
                redirectTo: "/intro"
            });
    });

    app.directive("searchresult", function () {
        return {
            restrict: 'E',
            templateUrl: 'directives/searchResult.html'
        };
    });

    app.service('sharedProperties', function () {
        var property = 'First';

        return {
            getProperty: function () {
                return property;
            },
            setProperty: function (value) {
                property = value;
            }
        };
    });

})();

/**
 * Created by Jonatan on 6/12/2015.
 */

(function () {
    "use strict";

    var adminController = function ($scope) {

    };

    angular.module("geofeelings").controller("adminController", ["$scope", adminController]);
})();
/**
 * Created by Jonatan on 4/12/2015.
 */


(function () {
    "use strict";

    var eventController = function ($scope) {

    };

    angular.module("geofeelings").controller("eventController", ["$scope", eventController]);
})();
/**
 * Created by Jonatan on 1/12/2015.
 */

(function () {
    "use strict";

    var introController = function ($scope, shareService, $http ) {


        //SMILEY TEKENEN
        $scope.sliderValue = 50;
        $scope.moodWord = null;
        var c = document.getElementById("smileyCanvas");
        var ctx = c.getContext("2d");

        var sadRGB = [152, 30, 30];
        var happyRGB = [70, 161, 73];

        //telkens slidervalue verandert gezichtje tekenen
        $scope.$watch("sliderValue", function () {
            ctx.clearRect(0, 0, c.width, c.height); //canvas clearen voor nieuw frame

            var mood = $scope.sliderValue;
            giveMoodWord();
            //offset positie mond
            var offsetX = c.width / 5;
            var offSetY = c.width / 2.14 + (mood / (c.width / 6));

            //variabelen voor beziercurve (= mond)
            var SPx = offsetX;
            var SPy = offSetY + c.width / 3 - (mood * (c.width / 376.66));
            var H1x = offsetX;
            var H1y = offSetY + (mood * (c.width / 250));
            var H2x = offsetX + ((c.width / 300) * 180);
            var H2y = offSetY + (mood * (c.width / 250));
            var EPx = offsetX + (c.width / 1.666);
            var EPy = offSetY + (c.width / 3) - (mood * (c.width / 376.66));

            //hoofd
            ctx.lineWidth = c.width / 60;
            ctx.beginPath();
            ctx.arc((c.width / 2), (c.width / 2), (c.width / 2.07), 0, 2 * Math.PI);
            ctx.fillStyle = "rgb(" + moodColor(0) + "," + moodColor(1) + "," + moodColor(2) + ")";
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.stroke();

            //mond

            ctx.lineWidth = c.width / 30;
            ctx.beginPath();
            ctx.moveTo(SPx, SPy);
            ctx.bezierCurveTo(H1x, H1y, H2x, H2y, EPx, EPy);
            ctx.strokeStyle = 'black';
            ctx.stroke();
            ctx.lineCap = "round";

            //oog links

            ctx.lineWidth = c.width / 60;
            ctx.beginPath();
            ctx.arc(c.width / 3, c.width / 3, c.width / 15, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.stroke();

            //oog rechts
            ctx.beginPath();
            ctx.arc(c.width / 3 * 2, c.width / 3, c.width / 15, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.stroke();
        });

        var moodColor = function (c) {
            //c: R = 0, G = 1, B = 2

            if (sadRGB[c] > happyRGB[c]) {
                return Math.round(sadRGB[c] - ((sadRGB[c] - happyRGB[c]) * ($scope.sliderValue / 100)));
            }
            else {
                return Math.round(sadRGB[c] + ((happyRGB[c] - sadRGB[c]) * ($scope.sliderValue / 100)));
            }

        };

        var moodwords = ["horrible", "really bad", "bad", "okay", "good", "really good", "excellent"];

        var giveMoodWord = function () {
            if ($scope.sliderValue < 5) {
                $scope.moodWord = moodwords[0];
            }
            else if ($scope.sliderValue < 25) {
                $scope.moodWord = moodwords[1];
            }
            else if ($scope.sliderValue < 40) {
                $scope.moodWord = moodwords[2];
            }
            else if ($scope.sliderValue < 60) {
                $scope.moodWord = moodwords[3];
            }
            else if ($scope.sliderValue < 75) {
                $scope.moodWord = moodwords[4];
            }
            else if ($scope.sliderValue < 95) {
                $scope.moodWord = moodwords[5];
            }
            else {
                $scope.moodWord = moodwords[6];
            }
        };

        $http.get('/auth/user').success(function (data) {
            console.log(data);
            $scope.user = data;
        });

        $scope.postShare = function () {
            navigator.geolocation.getCurrentPosition(function (position) {
                var data = {
                    "userid": $scope.user._id,
                    "eventid": 0,
                    "time": new Date().toISOString(),
                    "mood": $scope.sliderValue,
                    "lat": position.coords.latitude,
                    "lng": position.coords.longitude
                };

                shareService.postShare(data);


            });
        };
    };

    angular.module("geofeelings").controller("introController", ["$scope", "shareService", "$http", introController]);
})();
/**
 * Created by Lienert on 21/12/2015.
 */

(function () {
    "use strict";

    var intro_sharedController = function ($scope, $http) {
        console.log( $scope.sharedShare);

    };
    angular.module("geofeelings").controller("intro_sharedController", ["$scope","$http", intro_sharedController]);
})();
/**
 * Created by Jonatan on 6/12/2015.
 */

(function () {
    "use strict";

    var locationController = function ($scope) {

    };

    angular.module("geofeelings").controller("locationController", ["$scope", locationController]);
})();
/**
 * Created by Jonatan on 26/11/2015.
 */

(function () {
    "use strict";

    var loginController = function ($scope, $http, $location) {
        $scope.login = function () {
            $http.post('http://localhost:3000/auth/login', {
                username : $scope.username,
                password : $scope.password
            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });
        };

        $scope.register = function() {
            $http.post('http://localhost:3000/auth/register', {
                username : $scope.username,
                password : $scope.password,
                email : $scope.email
            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });
        };
    };

    angular.module("geofeelings").controller("loginController", ["$scope", "$http", "$location", loginController]);
})();
/**
 * Created by Jonatan on 21/11/2015.
 */

(function () {
    "use strict";

    var mainController = function ($scope) {
        if (navigator.geolocation) {
            $scope.image = "./assets/location_now.png";
            $scope.mapOptions = {
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                disableDefaultUI: true
            };

            $scope.map = new google.maps.Map(document.querySelector("#map"), $scope.mapOptions);

            navigator.geolocation.getCurrentPosition(function (position) {
                $scope.map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
                $scope.marker = new google.maps.Marker({
                    position: $scope.map.getCenter(),
                    map: $scope.map,
                    icon: $scope.image
                });
            });
        } else {
            //throw exception
        }
    };

    angular.module("geofeelings").controller("mainController", ["$scope", mainController]);
})();
/**
 * Created by Jonatan on 25/11/2015.
 */


(function () {
    "use strict";

    var searchController = function ($scope, searchService, sharedProperties) {

        $scope.searchModel = null;

        $scope.searchOnSubmit = function (formObj) {
            if ($scope.searchModel.length > 0) {
                searchNow();
            }
        };
        $scope.searchOnKeyPress = function () {
            if ($scope.searchModel !== null) {
                searchNow();
            }
        };

        $scope.filterSearchResults = function (i) {
            if ($scope.searchModel === "") {
                return false;
            }

            if (i.username.toLowerCase().indexOf($scope.searchModel.toLocaleLowerCase()) >= 0) {
                return true;
            }
            if (i.description !== undefined) {
                if (i.description.toLowerCase().indexOf($scope.searchModel.toLocaleLowerCase()) >= 0) {
                    return true;
                }
            }

            return false;
        };


        var searchNow = function () {
            searchService.search($scope.searchModel).then(onResultsReady);
        };

        var onResultsReady = function (res) {
            $scope.searchResults = res;
        };

        var onResultsError = function (err) {
        };
    };

    angular.module("geofeelings").controller("searchController", ["$scope", "searchService","sharedProperties", searchController]);
})();
/**
 * Created by Jonatan on 21/12/2015.
 */

(function () {
    "use strict";

    var meController = function ($scope, $http, $location, googleMapsService) {
        $http.get('/auth/user').success(function(data) {
            if(data.redirect) {
                $location.path(data.redirect);
            } else {
                $scope.user = data;
                $scope.user.age = convertDate($scope.user.age);
                convertCoord($scope.user.lat, $scope.user.lng);

                $http.get('/api/share/' + $scope.user._id).success(function (data) {
                    if(data.redirect) {
                        $location.path(data.redirect);
                    }

                    $scope.shares = data;
                });
            }
        });

        $scope.logout = function() {
            $http.get('/auth/logout').success(function (data) {
                $location.path(data.redirect);
            });
        };

        $scope.save = function(user) {
            googleMapsService.convertAdressToCoordinates(makeAddress($scope.user.address1, $scope.user.address2), function(err, coord) {
                if(!err) {
                    $scope.$apply(function () {
                        $http.put('/api/user/' + $scope.user._id, user).success(function (data) {
                            if (data.redirect) {
                                $location.path(data.redirect);
                            } else {
                                $scope.user = data;
                                $scope.user.age = convertDate($scope.user.age);
                                convertCoord(coord.lat(), coord.lng());
                            }
                        });
                    });
                }
            });
        };

        var convertDate = function (date) {
            return new Date(date);
        };

        var splitAddress = function (address, part) {
            var split = address.split(",");
            return split[part];
        };

        var makeAddress = function (part1, part2) {
            return part1 +  "," + part2;
        };

        var convertCoord = function(lat, lng) {
            googleMapsService.convertCoordinateToAdress(lat, lng, function(err, address) {
                if(!err) {
                    $scope.$apply(function() {
                        $scope.user.address1 = splitAddress(address, 0);
                        $scope.user.address2 = splitAddress(address, 1);
                    });
                } else {
                    console.log("> error: " + err);
                }
            });
        };
    };

    angular.module("geofeelings").controller("meController", ["$scope", "$http", "$location", "googleMapsService", meController]);
})();
/**
 * Created by Jonatan on 1/12/2015.
 */

(function () {
    "use strict";

    var userController = function ($scope, $location, searchService, shareService, $routeParams) {

        $scope.init = function () {
            var userid = $routeParams.param;
            searchService.searchUserFromId(userid).then(userFoundWithId);
            shareService.getSharesByUserId(userid).then(sharesFoundWithId); //IMPLEMENTEREN ALS JONATAN DE API FTIE HEEFT AANGEMAAKT
        };

        var userFoundWithId = function (res) {
            $scope.userfoundwithid = res;

            if (res.lat !== undefined && res.lat !== undefined) {
                $scope.map.setCenter(new google.maps.LatLng(res.lat, res.lng));
                if ($scope.marker !== undefined) {
                    $scope.marker.setMap(null); //verwijdert alle markers eerst
                }
                $scope.marker = new google.maps.Marker({
                    position: {lat: res.lat, lng: res.lng},
                    map: $scope.map,
                    icon: $scope.image
                });
            }
        };



        $scope.test = function(share)
        {
            $scope.map.setCenter(new google.maps.LatLng(share.lat, share.lng));
            $scope.map.setZoom(19);
        };

        var giveFeelingsImageArrayNumber = function (res) {
            if (res.mood > 80) {
                return 4;
            }
            else {
                return Math.round(res.mood / 20);
            }
        };

        var sharesFoundWithId = function (res) {
            $scope.shareFoundWithUserId = res;

            //markers plaatsen en kaart verplaatsen naar hun gemiddelde
            var minLat = 100,
                maxLat = 0,
                minLng = 100,
                maxLng = 0,
                teller = 0,
                gemLat = 0,
                gemLng = 0;

            $scope.marker.setMap(null); //verwijdert alle markers eerst

            var feelingImages = ["depressed", "sad", "common", "happy", "excited"];

            res.forEach(function (res) {

                teller++;
                if (res.lat < minLat) {
                    minLat = res.lat;
                }
                if (res.lat > maxLat) {
                    maxLat = res.lat;
                }

                if (res.lng < minLng) {
                    minLng = res.lng;
                }
                if (res.lng > maxLng) {
                    maxLng = res.lng;
                }

                res.moodImageSource = "./assets/" + feelingImages[giveFeelingsImageArrayNumber(res)] + ".png";

                $scope.marker = new google.maps.Marker({
                    position: {lat: res.lat, lng: res.lng},
                    map: $scope.map,
                    icon: res.moodImageSource
                });
            });

            if (teller == 1) {
                gemLat = res[0].lat;
                gemLng = res[0].lng;
            }
            else {
                gemLat = ((maxLat - minLat) / 2) + minLat;
                gemLng = ((maxLng - minLng) / 2) + minLng;
            }



            $scope.map.setCenter(new google.maps.LatLng(gemLat, gemLng));
            $scope.map.setZoom(14);
            //klaar met markers plaatsen en kaart verplaatsen naar hun gemiddelde
        };
    };

    angular.module("geofeelings").controller("userController", ["$scope", "$location", "searchService","shareService","$routeParams", userController]);
})
();
/**
 * Created by Jonatan on 22/12/2015.
 */

// https://developers.google.com/maps/documentation/geocoding/intro?csw=1#Geocoding
// Dit gebruiken om adressen te vertalen naar lat en lng of omgekeerd
// Waarom? => google maps werkt met lat en lng, wordt zo opgeslaan in de database

var googleMapsService = function () {
    "use strict";
    // private
    var geocoder = new google.maps.Geocoder();

    //public
    return {
        showLocationOnMap: function (lat, lng) {

        },

        convertAdressToCoordinates: function (address, cb) {
            geocoder.geocode({address: address}, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    cb(null, results[0].geometry.location);
                } else {
                    cb(status, null);
                }
            });
        },

        convertCoordinateToAdress: function (lat, lng, cb) {
            var location = new google.maps.LatLng(lat, lng);
            geocoder.geocode({latLng: location}, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    cb(null, results[0].formatted_address);
                } else {
                    cb(status, null);
                }
            });
        }
    };
};

angular.module("geofeelings").factory("googleMapsService", ["$http", googleMapsService]);
(function () {
    "use strict";

    var searchService = function ($http) {

        var search = function (searchString) {
            var url = 'http://localhost:3000/api/user/';

            return $http.get(url).then(function (response) {

                var arSearchResults = [];
                angular.forEach(response.data, function (searchR) {
                    var newSR = new SearchResult(searchR._id, searchR.username);
                    arSearchResults.push(newSR);
                });
                return arSearchResults;
            });
        };

        var searchUserFromId = function (searchString) {
            var url = 'http://localhost:3000/api/user/' + searchString;
            return $http.get(url).then(function (response) {
                return new GfUser(
                    response.data._id,
                    response.data.username,
                    response.data.email,
                    response.data.userimage,
                    response.data.age,
                    response.data.lat,
                    response.data.lng,
                    response.data.chat,
                    response.data.admin
                );

            });
            };

        return {
            search: search,
            searchUserFromId: searchUserFromId
        };
    };
    angular.module("geofeelings").factory("searchService", ["$http", searchService]);
})();
/**
 * Created by Lienert on 23/12/2015.
 */

(function () {
    "use strict";

    var shareService = function ($http) {

        var postShare = function (data) {

            $http({
                url: 'http://localhost:3000/api/share',
                method: 'POST',
                data: data,
                headers: {'Content-Type': 'application/json'}
            }).
                success(function (serverData) {
                    console.log("dees moetk nog naar een andere controller krijgen "+serverData);
                });
        };

        var getSharesByUserId = function (userid) {
            var url = 'http://localhost:3000/api/share/' + userid; //NIEUW PAD!!! (al aangepast)
            return $http.get(url).then(function (response) {

                var sharesfound = [];
                angular.forEach(response.data, function (share) {
                    var newShare = new GFShare(share._id, share.userid, share.eventid, share.time, share.mood, share.lat, share.lng);
                    sharesfound.push(newShare);
                });
                return sharesfound;
            });
        };

        return {
            postShare: postShare,
            getSharesByUserId:getSharesByUserId
        };
    };
    angular.module("geofeelings").factory("shareService", ["$http",shareService]);
})();
function GFShare(id, userid, eventid, time, mood, lat, lng) {
    this.id = id;
    this.userid = userid;
    this.eventid = eventid;
    this.time = time;
    this.mood = mood;
    this.lat = lat;
    this.lng = lng;
}
GFShare.prototype.toString = function () {
    return this.user + " (" + this.time + ")";
};

function GfUser(id, username, email, userimage, age, lat, lng, chat, admin) {
    this.id = id;
    this.username = username;
    this.email = email;
    this.userimage = userimage;
    this.age = age;
    this.lat = lat;
    this.lng = lng;
    this.chat = chat;
    this.admin = admin;
}
GfUser.prototype.toString = function () {
    return this.username;
};

function SearchResult(id,username)
{
    this.id = id;
    this.username = username;
}
SearchResult.prototype.toString = function() {
    return this.title;
};

/**
 * Created by Jonatan on 22/11/2015.
 */

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFkbWluQ29udHJvbGxlci9hZG1pbkNvbnRyb2xsZXIuanMiLCJldmVudENvbnRyb2xsZXIvZXZlbnRDb250cm9sbGVyLmpzIiwiaW50cm9Db250cm9sbGVyL2ludHJvQ29udHJvbGxlci5qcyIsImludHJvQ29udHJvbGxlci9pbnRyb19zaGFyZWRDb250cm9sbGVyLmpzIiwibG9jYXRpb25Db250cm9sbGVyL2xvY2F0aW9uQ29udHJvbGxlci5qcyIsImxvZ2luQ29udHJvbGxlci9sb2dpbkNvbnRyb2xsZXIuanMiLCJtYWluQ29udHJvbGxlci9tYWluQ29udHJvbGxlci5qcyIsInNlYXJjaENvbnRyb2xsZXIvc2VhcmNoQ29udHJvbGxlci5qcyIsInVzZXJDb250cm9sbGVyL21lQ29udHJvbGxlci5qcyIsInVzZXJDb250cm9sbGVyL3VzZXJDb250cm9sbGVyLmpzIiwiZ29vZ2xlTWFwc1NlcnZpY2UuanMiLCJzZWFyY2hTZXJ2aWNlLmpzIiwic2hhcmVTZXJ2aWNlLmpzIiwiZ2ZTaGFyZS5qcyIsImdmVXNlci5qcyIsIlNlYXJjaFJlc3VsdC5qcyIsIm1hcEV4Y2VwdGlvbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiLCBbXCJuZ1JvdXRlXCJdKTtcclxuXHJcbiAgICBhcHAuY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKFwiL2FkbWluXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvYWRtaW5Db250cm9sbGVyL2FkbWluLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL3NlYXJjaFwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL3NlYXJjaENvbnRyb2xsZXIvc2VhcmNoLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2ludHJvXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvaW50cm9Db250cm9sbGVyL2ludHJvLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2hlbHBcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9kaXJlY3RpdmVzL2hlbHAuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvbG9naW5cIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIvbG9naW4uaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvcmVnaXN0ZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIvcmVnaXN0ZXIuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvcGFzc3dvcmRcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIvcGFzc3dvcmQuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvdXNlclwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL3VzZXJDb250cm9sbGVyL3VzZXIuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvdXNlci86cGFyYW1cIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy91c2VyQ29udHJvbGxlci91c2VyLmh0bWxcIixcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSkud2hlbihcIi9tZVwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL3VzZXJDb250cm9sbGVyL21lLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2V2ZW50XCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvZXZlbnRDb250cm9sbGVyL2V2ZW50Lmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2FkZEV2ZW50XCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvZXZlbnRDb250cm9sbGVyL2FkZEV2ZW50Lmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2xvY2F0aW9uXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvbG9jYXRpb25Db250cm9sbGVyL2xvY2F0aW9uLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2ludHJvX3NoYXJlZFwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL2ludHJvQ29udHJvbGxlci9pbnRyb19zaGFyZWQuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLm90aGVyd2lzZSh7XHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFRvOiBcIi9pbnRyb1wiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZShcInNlYXJjaHJlc3VsdFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdkaXJlY3RpdmVzL3NlYXJjaFJlc3VsdC5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAuc2VydmljZSgnc2hhcmVkUHJvcGVydGllcycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcHJvcGVydHkgPSAnRmlyc3QnO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRQcm9wZXJ0eTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXRQcm9wZXJ0eTogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiA2LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBhZG1pbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmNvbnRyb2xsZXIoXCJhZG1pbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIGFkbWluQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gNC8xMi8yMDE1LlxyXG4gKi9cclxuXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGV2ZW50Q29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImV2ZW50Q29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgZXZlbnRDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiAxLzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBpbnRyb0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCBzaGFyZVNlcnZpY2UsICRodHRwICkge1xyXG5cclxuXHJcbiAgICAgICAgLy9TTUlMRVkgVEVLRU5FTlxyXG4gICAgICAgICRzY29wZS5zbGlkZXJWYWx1ZSA9IDUwO1xyXG4gICAgICAgICRzY29wZS5tb29kV29yZCA9IG51bGw7XHJcbiAgICAgICAgdmFyIGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNtaWxleUNhbnZhc1wiKTtcclxuICAgICAgICB2YXIgY3R4ID0gYy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgICAgIHZhciBzYWRSR0IgPSBbMTUyLCAzMCwgMzBdO1xyXG4gICAgICAgIHZhciBoYXBweVJHQiA9IFs3MCwgMTYxLCA3M107XHJcblxyXG4gICAgICAgIC8vdGVsa2VucyBzbGlkZXJ2YWx1ZSB2ZXJhbmRlcnQgZ2V6aWNodGplIHRla2VuZW5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKFwic2xpZGVyVmFsdWVcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGMud2lkdGgsIGMuaGVpZ2h0KTsgLy9jYW52YXMgY2xlYXJlbiB2b29yIG5pZXV3IGZyYW1lXHJcblxyXG4gICAgICAgICAgICB2YXIgbW9vZCA9ICRzY29wZS5zbGlkZXJWYWx1ZTtcclxuICAgICAgICAgICAgZ2l2ZU1vb2RXb3JkKCk7XHJcbiAgICAgICAgICAgIC8vb2Zmc2V0IHBvc2l0aWUgbW9uZFxyXG4gICAgICAgICAgICB2YXIgb2Zmc2V0WCA9IGMud2lkdGggLyA1O1xyXG4gICAgICAgICAgICB2YXIgb2ZmU2V0WSA9IGMud2lkdGggLyAyLjE0ICsgKG1vb2QgLyAoYy53aWR0aCAvIDYpKTtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyaWFiZWxlbiB2b29yIGJlemllcmN1cnZlICg9IG1vbmQpXHJcbiAgICAgICAgICAgIHZhciBTUHggPSBvZmZzZXRYO1xyXG4gICAgICAgICAgICB2YXIgU1B5ID0gb2ZmU2V0WSArIGMud2lkdGggLyAzIC0gKG1vb2QgKiAoYy53aWR0aCAvIDM3Ni42NikpO1xyXG4gICAgICAgICAgICB2YXIgSDF4ID0gb2Zmc2V0WDtcclxuICAgICAgICAgICAgdmFyIEgxeSA9IG9mZlNldFkgKyAobW9vZCAqIChjLndpZHRoIC8gMjUwKSk7XHJcbiAgICAgICAgICAgIHZhciBIMnggPSBvZmZzZXRYICsgKChjLndpZHRoIC8gMzAwKSAqIDE4MCk7XHJcbiAgICAgICAgICAgIHZhciBIMnkgPSBvZmZTZXRZICsgKG1vb2QgKiAoYy53aWR0aCAvIDI1MCkpO1xyXG4gICAgICAgICAgICB2YXIgRVB4ID0gb2Zmc2V0WCArIChjLndpZHRoIC8gMS42NjYpO1xyXG4gICAgICAgICAgICB2YXIgRVB5ID0gb2ZmU2V0WSArIChjLndpZHRoIC8gMykgLSAobW9vZCAqIChjLndpZHRoIC8gMzc2LjY2KSk7XHJcblxyXG4gICAgICAgICAgICAvL2hvb2ZkXHJcbiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBjLndpZHRoIC8gNjA7XHJcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgY3R4LmFyYygoYy53aWR0aCAvIDIpLCAoYy53aWR0aCAvIDIpLCAoYy53aWR0aCAvIDIuMDcpLCAwLCAyICogTWF0aC5QSSk7XHJcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYihcIiArIG1vb2RDb2xvcigwKSArIFwiLFwiICsgbW9vZENvbG9yKDEpICsgXCIsXCIgKyBtb29kQ29sb3IoMikgKyBcIilcIjtcclxuICAgICAgICAgICAgY3R4LmZpbGwoKTtcclxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3doaXRlJztcclxuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG5cclxuICAgICAgICAgICAgLy9tb25kXHJcblxyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYy53aWR0aCAvIDMwO1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oU1B4LCBTUHkpO1xyXG4gICAgICAgICAgICBjdHguYmV6aWVyQ3VydmVUbyhIMXgsIEgxeSwgSDJ4LCBIMnksIEVQeCwgRVB5KTtcclxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ2JsYWNrJztcclxuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICBjdHgubGluZUNhcCA9IFwicm91bmRcIjtcclxuXHJcbiAgICAgICAgICAgIC8vb29nIGxpbmtzXHJcblxyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYy53aWR0aCAvIDYwO1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5hcmMoYy53aWR0aCAvIDMsIGMud2lkdGggLyAzLCBjLndpZHRoIC8gMTUsIDAsIDIgKiBNYXRoLlBJKTtcclxuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7XHJcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XHJcbiAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuXHJcbiAgICAgICAgICAgIC8vb29nIHJlY2h0c1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5hcmMoYy53aWR0aCAvIDMgKiAyLCBjLndpZHRoIC8gMywgYy53aWR0aCAvIDE1LCAwLCAyICogTWF0aC5QSSk7XHJcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgICAgICAgICBjdHguZmlsbCgpO1xyXG4gICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBtb29kQ29sb3IgPSBmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAvL2M6IFIgPSAwLCBHID0gMSwgQiA9IDJcclxuXHJcbiAgICAgICAgICAgIGlmIChzYWRSR0JbY10gPiBoYXBweVJHQltjXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoc2FkUkdCW2NdIC0gKChzYWRSR0JbY10gLSBoYXBweVJHQltjXSkgKiAoJHNjb3BlLnNsaWRlclZhbHVlIC8gMTAwKSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoc2FkUkdCW2NdICsgKChoYXBweVJHQltjXSAtIHNhZFJHQltjXSkgKiAoJHNjb3BlLnNsaWRlclZhbHVlIC8gMTAwKSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBtb29kd29yZHMgPSBbXCJob3JyaWJsZVwiLCBcInJlYWxseSBiYWRcIiwgXCJiYWRcIiwgXCJva2F5XCIsIFwiZ29vZFwiLCBcInJlYWxseSBnb29kXCIsIFwiZXhjZWxsZW50XCJdO1xyXG5cclxuICAgICAgICB2YXIgZ2l2ZU1vb2RXb3JkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgNSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5zbGlkZXJWYWx1ZSA8IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubW9vZFdvcmQgPSBtb29kd29yZHNbMV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgNDApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1syXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICgkc2NvcGUuc2xpZGVyVmFsdWUgPCA2MCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzNdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5zbGlkZXJWYWx1ZSA8IDc1KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubW9vZFdvcmQgPSBtb29kd29yZHNbNF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgOTUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1s1XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1s2XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRodHRwLmdldCgnL2F1dGgvdXNlcicpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnBvc3RTaGFyZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwidXNlcmlkXCI6ICRzY29wZS51c2VyLl9pZCxcclxuICAgICAgICAgICAgICAgICAgICBcImV2ZW50aWRcIjogMCxcclxuICAgICAgICAgICAgICAgICAgICBcInRpbWVcIjogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibW9vZFwiOiAkc2NvcGUuc2xpZGVyVmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJsYXRcIjogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibG5nXCI6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2hhcmVTZXJ2aWNlLnBvc3RTaGFyZShkYXRhKTtcclxuXHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmNvbnRyb2xsZXIoXCJpbnRyb0NvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic2hhcmVTZXJ2aWNlXCIsIFwiJGh0dHBcIiwgaW50cm9Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTGllbmVydCBvbiAyMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgaW50cm9fc2hhcmVkQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICRodHRwKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coICRzY29wZS5zaGFyZWRTaGFyZSk7XHJcblxyXG4gICAgfTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImludHJvX3NoYXJlZENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsXCIkaHR0cFwiLCBpbnRyb19zaGFyZWRDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiA2LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBsb2NhdGlvbkNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmNvbnRyb2xsZXIoXCJsb2NhdGlvbkNvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIGxvY2F0aW9uQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMjYvMTEvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGxvZ2luQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hdXRoL2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgOiAkc2NvcGUudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZCA6ICRzY29wZS5wYXNzd29yZFxyXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXV0aC9yZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogJHNjb3BlLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQgOiAkc2NvcGUucGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBlbWFpbCA6ICRzY29wZS5lbWFpbFxyXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRsb2NhdGlvblwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIxLzExLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBtYWluQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pbWFnZSA9IFwiLi9hc3NldHMvbG9jYXRpb25fbm93LnBuZ1wiO1xyXG4gICAgICAgICAgICAkc2NvcGUubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHpvb206IDE1LFxyXG4gICAgICAgICAgICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUCxcclxuICAgICAgICAgICAgICAgIGRpc2FibGVEZWZhdWx0VUk6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFwXCIpLCAkc2NvcGUubWFwT3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsIHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJHNjb3BlLm1hcC5nZXRDZW50ZXIoKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJHNjb3BlLmltYWdlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy90aHJvdyBleGNlcHRpb25cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcIm1haW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBtYWluQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMjUvMTEvMjAxNS5cclxuICovXHJcblxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBzZWFyY2hDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgc2VhcmNoU2VydmljZSwgc2hhcmVkUHJvcGVydGllcykge1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VhcmNoTW9kZWwgPSBudWxsO1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VhcmNoT25TdWJtaXQgPSBmdW5jdGlvbiAoZm9ybU9iaikge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNlYXJjaE1vZGVsLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaE5vdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuc2VhcmNoT25LZXlQcmVzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zZWFyY2hNb2RlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoTm93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZmlsdGVyU2VhcmNoUmVzdWx0cyA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoTW9kZWwgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGkudXNlcm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCRzY29wZS5zZWFyY2hNb2RlbC50b0xvY2FsZUxvd2VyQ2FzZSgpKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaS5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJHNjb3BlLnNlYXJjaE1vZGVsLnRvTG9jYWxlTG93ZXJDYXNlKCkpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB2YXIgc2VhcmNoTm93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWFyY2hTZXJ2aWNlLnNlYXJjaCgkc2NvcGUuc2VhcmNoTW9kZWwpLnRoZW4ob25SZXN1bHRzUmVhZHkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBvblJlc3VsdHNSZWFkeSA9IGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaFJlc3VsdHMgPSByZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG9uUmVzdWx0c0Vycm9yID0gZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcInNlYXJjaENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic2VhcmNoU2VydmljZVwiLFwic2hhcmVkUHJvcGVydGllc1wiLCBzZWFyY2hDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiAyMS8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgZ29vZ2xlTWFwc1NlcnZpY2UpIHtcclxuICAgICAgICAkaHR0cC5nZXQoJy9hdXRoL3VzZXInKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYoZGF0YS5yZWRpcmVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlciA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlci5hZ2UgPSBjb252ZXJ0RGF0ZSgkc2NvcGUudXNlci5hZ2UpO1xyXG4gICAgICAgICAgICAgICAgY29udmVydENvb3JkKCRzY29wZS51c2VyLmxhdCwgJHNjb3BlLnVzZXIubG5nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2hhcmUvJyArICRzY29wZS51c2VyLl9pZCkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2hhcmVzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXV0aC9sb2dvdXQnKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIGdvb2dsZU1hcHNTZXJ2aWNlLmNvbnZlcnRBZHJlc3NUb0Nvb3JkaW5hdGVzKG1ha2VBZGRyZXNzKCRzY29wZS51c2VyLmFkZHJlc3MxLCAkc2NvcGUudXNlci5hZGRyZXNzMiksIGZ1bmN0aW9uKGVyciwgY29vcmQpIHtcclxuICAgICAgICAgICAgICAgIGlmKCFlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGh0dHAucHV0KCcvYXBpL3VzZXIvJyArICRzY29wZS51c2VyLl9pZCwgdXNlcikuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmFnZSA9IGNvbnZlcnREYXRlKCRzY29wZS51c2VyLmFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVydENvb3JkKGNvb3JkLmxhdCgpLCBjb29yZC5sbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY29udmVydERhdGUgPSBmdW5jdGlvbiAoZGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNwbGl0QWRkcmVzcyA9IGZ1bmN0aW9uIChhZGRyZXNzLCBwYXJ0KSB7XHJcbiAgICAgICAgICAgIHZhciBzcGxpdCA9IGFkZHJlc3Muc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gc3BsaXRbcGFydF07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG1ha2VBZGRyZXNzID0gZnVuY3Rpb24gKHBhcnQxLCBwYXJ0Mikge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFydDEgKyAgXCIsXCIgKyBwYXJ0MjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY29udmVydENvb3JkID0gZnVuY3Rpb24obGF0LCBsbmcpIHtcclxuICAgICAgICAgICAgZ29vZ2xlTWFwc1NlcnZpY2UuY29udmVydENvb3JkaW5hdGVUb0FkcmVzcyhsYXQsIGxuZywgZnVuY3Rpb24oZXJyLCBhZGRyZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZighZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuYWRkcmVzczEgPSBzcGxpdEFkZHJlc3MoYWRkcmVzcywgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmFkZHJlc3MyID0gc3BsaXRBZGRyZXNzKGFkZHJlc3MsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj4gZXJyb3I6IFwiICsgZXJyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwibWVDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIFwiZ29vZ2xlTWFwc1NlcnZpY2VcIiwgbWVDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiAxLzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciB1c2VyQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2VhcmNoU2VydmljZSwgc2hhcmVTZXJ2aWNlLCAkcm91dGVQYXJhbXMpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyaWQgPSAkcm91dGVQYXJhbXMucGFyYW07XHJcbiAgICAgICAgICAgIHNlYXJjaFNlcnZpY2Uuc2VhcmNoVXNlckZyb21JZCh1c2VyaWQpLnRoZW4odXNlckZvdW5kV2l0aElkKTtcclxuICAgICAgICAgICAgc2hhcmVTZXJ2aWNlLmdldFNoYXJlc0J5VXNlcklkKHVzZXJpZCkudGhlbihzaGFyZXNGb3VuZFdpdGhJZCk7IC8vSU1QTEVNRU5URVJFTiBBTFMgSk9OQVRBTiBERSBBUEkgRlRJRSBIRUVGVCBBQU5HRU1BQUtUXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVzZXJGb3VuZFdpdGhJZCA9IGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJmb3VuZHdpdGhpZCA9IHJlcztcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXMubGF0ICE9PSB1bmRlZmluZWQgJiYgcmVzLmxhdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWFwLnNldENlbnRlcihuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHJlcy5sYXQsIHJlcy5sbmcpKTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubWFya2VyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFya2VyLnNldE1hcChudWxsKTsgLy92ZXJ3aWpkZXJ0IGFsbGUgbWFya2VycyBlZXJzdFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7bGF0OiByZXMubGF0LCBsbmc6IHJlcy5sbmd9LFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcDogJHNjb3BlLm1hcCxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAkc2NvcGUuaW1hZ2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG5cclxuICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uKHNoYXJlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzaGFyZS5sYXQsIHNoYXJlLmxuZykpO1xyXG4gICAgICAgICAgICAkc2NvcGUubWFwLnNldFpvb20oMTkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnaXZlRmVlbGluZ3NJbWFnZUFycmF5TnVtYmVyID0gZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICBpZiAocmVzLm1vb2QgPiA4MCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChyZXMubW9vZCAvIDIwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzaGFyZXNGb3VuZFdpdGhJZCA9IGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNoYXJlRm91bmRXaXRoVXNlcklkID0gcmVzO1xyXG5cclxuICAgICAgICAgICAgLy9tYXJrZXJzIHBsYWF0c2VuIGVuIGthYXJ0IHZlcnBsYWF0c2VuIG5hYXIgaHVuIGdlbWlkZGVsZGVcclxuICAgICAgICAgICAgdmFyIG1pbkxhdCA9IDEwMCxcclxuICAgICAgICAgICAgICAgIG1heExhdCA9IDAsXHJcbiAgICAgICAgICAgICAgICBtaW5MbmcgPSAxMDAsXHJcbiAgICAgICAgICAgICAgICBtYXhMbmcgPSAwLFxyXG4gICAgICAgICAgICAgICAgdGVsbGVyID0gMCxcclxuICAgICAgICAgICAgICAgIGdlbUxhdCA9IDAsXHJcbiAgICAgICAgICAgICAgICBnZW1MbmcgPSAwO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLm1hcmtlci5zZXRNYXAobnVsbCk7IC8vdmVyd2lqZGVydCBhbGxlIG1hcmtlcnMgZWVyc3RcclxuXHJcbiAgICAgICAgICAgIHZhciBmZWVsaW5nSW1hZ2VzID0gW1wiZGVwcmVzc2VkXCIsIFwic2FkXCIsIFwiY29tbW9uXCIsIFwiaGFwcHlcIiwgXCJleGNpdGVkXCJdO1xyXG5cclxuICAgICAgICAgICAgcmVzLmZvckVhY2goZnVuY3Rpb24gKHJlcykge1xyXG5cclxuICAgICAgICAgICAgICAgIHRlbGxlcisrO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5sYXQgPCBtaW5MYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBtaW5MYXQgPSByZXMubGF0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5sYXQgPiBtYXhMYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXhMYXQgPSByZXMubGF0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXMubG5nIDwgbWluTG5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWluTG5nID0gcmVzLmxuZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZXMubG5nID4gbWF4TG5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4TG5nID0gcmVzLmxuZztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXMubW9vZEltYWdlU291cmNlID0gXCIuL2Fzc2V0cy9cIiArIGZlZWxpbmdJbWFnZXNbZ2l2ZUZlZWxpbmdzSW1hZ2VBcnJheU51bWJlcihyZXMpXSArIFwiLnBuZ1wiO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjoge2xhdDogcmVzLmxhdCwgbG5nOiByZXMubG5nfSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogcmVzLm1vb2RJbWFnZVNvdXJjZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRlbGxlciA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBnZW1MYXQgPSByZXNbMF0ubGF0O1xyXG4gICAgICAgICAgICAgICAgZ2VtTG5nID0gcmVzWzBdLmxuZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGdlbUxhdCA9ICgobWF4TGF0IC0gbWluTGF0KSAvIDIpICsgbWluTGF0O1xyXG4gICAgICAgICAgICAgICAgZ2VtTG5nID0gKChtYXhMbmcgLSBtaW5MbmcpIC8gMikgKyBtaW5Mbmc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhnZW1MYXQsIGdlbUxuZykpO1xyXG4gICAgICAgICAgICAkc2NvcGUubWFwLnNldFpvb20oMTQpO1xyXG4gICAgICAgICAgICAvL2tsYWFyIG1ldCBtYXJrZXJzIHBsYWF0c2VuIGVuIGthYXJ0IHZlcnBsYWF0c2VuIG5hYXIgaHVuIGdlbWlkZGVsZGVcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcImdlb2ZlZWxpbmdzXCIpLmNvbnRyb2xsZXIoXCJ1c2VyQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkbG9jYXRpb25cIiwgXCJzZWFyY2hTZXJ2aWNlXCIsXCJzaGFyZVNlcnZpY2VcIixcIiRyb3V0ZVBhcmFtc1wiLCB1c2VyQ29udHJvbGxlcl0pO1xyXG59KVxyXG4oKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIyLzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vbWFwcy9kb2N1bWVudGF0aW9uL2dlb2NvZGluZy9pbnRybz9jc3c9MSNHZW9jb2RpbmdcclxuLy8gRGl0IGdlYnJ1aWtlbiBvbSBhZHJlc3NlbiB0ZSB2ZXJ0YWxlbiBuYWFyIGxhdCBlbiBsbmcgb2Ygb21nZWtlZXJkXHJcbi8vIFdhYXJvbT8gPT4gZ29vZ2xlIG1hcHMgd2Vya3QgbWV0IGxhdCBlbiBsbmcsIHdvcmR0IHpvIG9wZ2VzbGFhbiBpbiBkZSBkYXRhYmFzZVxyXG5cclxudmFyIGdvb2dsZU1hcHNTZXJ2aWNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgICAvLyBwcml2YXRlXHJcbiAgICB2YXIgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKTtcclxuXHJcbiAgICAvL3B1YmxpY1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBzaG93TG9jYXRpb25Pbk1hcDogZnVuY3Rpb24gKGxhdCwgbG5nKSB7XHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGNvbnZlcnRBZHJlc3NUb0Nvb3JkaW5hdGVzOiBmdW5jdGlvbiAoYWRkcmVzcywgY2IpIHtcclxuICAgICAgICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7YWRkcmVzczogYWRkcmVzc30sIGZ1bmN0aW9uIChyZXN1bHRzLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCByZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Ioc3RhdHVzLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgY29udmVydENvb3JkaW5hdGVUb0FkcmVzczogZnVuY3Rpb24gKGxhdCwgbG5nLCBjYikge1xyXG4gICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxhdCwgbG5nKTtcclxuICAgICAgICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7bGF0TG5nOiBsb2NhdGlvbn0sIGZ1bmN0aW9uIChyZXN1bHRzLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCByZXN1bHRzWzBdLmZvcm1hdHRlZF9hZGRyZXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Ioc3RhdHVzLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuZmFjdG9yeShcImdvb2dsZU1hcHNTZXJ2aWNlXCIsIFtcIiRodHRwXCIsIGdvb2dsZU1hcHNTZXJ2aWNlXSk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBzZWFyY2hTZXJ2aWNlID0gZnVuY3Rpb24gKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWFyY2ggPSBmdW5jdGlvbiAoc2VhcmNoU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS91c2VyLyc7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYXJTZWFyY2hSZXN1bHRzID0gW107XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocmVzcG9uc2UuZGF0YSwgZnVuY3Rpb24gKHNlYXJjaFIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3U1IgPSBuZXcgU2VhcmNoUmVzdWx0KHNlYXJjaFIuX2lkLCBzZWFyY2hSLnVzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBhclNlYXJjaFJlc3VsdHMucHVzaChuZXdTUik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhclNlYXJjaFJlc3VsdHM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZWFyY2hVc2VyRnJvbUlkID0gZnVuY3Rpb24gKHNlYXJjaFN0cmluZykge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvdXNlci8nICsgc2VhcmNoU3RyaW5nO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR2ZVc2VyKFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLnVzZXJpbWFnZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmFnZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmxhdCxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmxuZyxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmNoYXQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5hZG1pblxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCxcclxuICAgICAgICAgICAgc2VhcmNoVXNlckZyb21JZDogc2VhcmNoVXNlckZyb21JZFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5mYWN0b3J5KFwic2VhcmNoU2VydmljZVwiLCBbXCIkaHR0cFwiLCBzZWFyY2hTZXJ2aWNlXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTGllbmVydCBvbiAyMy8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgc2hhcmVTZXJ2aWNlID0gZnVuY3Rpb24gKCRodHRwKSB7XHJcblxyXG4gICAgICAgIHZhciBwb3N0U2hhcmUgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9zaGFyZScsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ31cclxuICAgICAgICAgICAgfSkuXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uIChzZXJ2ZXJEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJkZWVzIG1vZXRrIG5vZyBuYWFyIGVlbiBhbmRlcmUgY29udHJvbGxlciBrcmlqZ2VuIFwiK3NlcnZlckRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFNoYXJlc0J5VXNlcklkID0gZnVuY3Rpb24gKHVzZXJpZCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvc2hhcmUvJyArIHVzZXJpZDsgLy9OSUVVVyBQQUQhISEgKGFsIGFhbmdlcGFzdClcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNoYXJlc2ZvdW5kID0gW107XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocmVzcG9uc2UuZGF0YSwgZnVuY3Rpb24gKHNoYXJlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1NoYXJlID0gbmV3IEdGU2hhcmUoc2hhcmUuX2lkLCBzaGFyZS51c2VyaWQsIHNoYXJlLmV2ZW50aWQsIHNoYXJlLnRpbWUsIHNoYXJlLm1vb2QsIHNoYXJlLmxhdCwgc2hhcmUubG5nKTtcclxuICAgICAgICAgICAgICAgICAgICBzaGFyZXNmb3VuZC5wdXNoKG5ld1NoYXJlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNoYXJlc2ZvdW5kO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwb3N0U2hhcmU6IHBvc3RTaGFyZSxcclxuICAgICAgICAgICAgZ2V0U2hhcmVzQnlVc2VySWQ6Z2V0U2hhcmVzQnlVc2VySWRcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuZmFjdG9yeShcInNoYXJlU2VydmljZVwiLCBbXCIkaHR0cFwiLHNoYXJlU2VydmljZV0pO1xyXG59KSgpOyIsImZ1bmN0aW9uIEdGU2hhcmUoaWQsIHVzZXJpZCwgZXZlbnRpZCwgdGltZSwgbW9vZCwgbGF0LCBsbmcpIHtcclxuICAgIHRoaXMuaWQgPSBpZDtcclxuICAgIHRoaXMudXNlcmlkID0gdXNlcmlkO1xyXG4gICAgdGhpcy5ldmVudGlkID0gZXZlbnRpZDtcclxuICAgIHRoaXMudGltZSA9IHRpbWU7XHJcbiAgICB0aGlzLm1vb2QgPSBtb29kO1xyXG4gICAgdGhpcy5sYXQgPSBsYXQ7XHJcbiAgICB0aGlzLmxuZyA9IGxuZztcclxufVxyXG5HRlNoYXJlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLnVzZXIgKyBcIiAoXCIgKyB0aGlzLnRpbWUgKyBcIilcIjtcclxufTtcclxuIiwiZnVuY3Rpb24gR2ZVc2VyKGlkLCB1c2VybmFtZSwgZW1haWwsIHVzZXJpbWFnZSwgYWdlLCBsYXQsIGxuZywgY2hhdCwgYWRtaW4pIHtcclxuICAgIHRoaXMuaWQgPSBpZDtcclxuICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcclxuICAgIHRoaXMuZW1haWwgPSBlbWFpbDtcclxuICAgIHRoaXMudXNlcmltYWdlID0gdXNlcmltYWdlO1xyXG4gICAgdGhpcy5hZ2UgPSBhZ2U7XHJcbiAgICB0aGlzLmxhdCA9IGxhdDtcclxuICAgIHRoaXMubG5nID0gbG5nO1xyXG4gICAgdGhpcy5jaGF0ID0gY2hhdDtcclxuICAgIHRoaXMuYWRtaW4gPSBhZG1pbjtcclxufVxyXG5HZlVzZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlcm5hbWU7XHJcbn07XHJcbiIsImZ1bmN0aW9uIFNlYXJjaFJlc3VsdChpZCx1c2VybmFtZSlcclxue1xyXG4gICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xyXG59XHJcblNlYXJjaFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLnRpdGxlO1xyXG59O1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIyLzExLzIwMTUuXHJcbiAqL1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

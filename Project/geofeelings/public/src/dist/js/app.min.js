(function () {
    "use strict";

    var app = angular.module("geofeelings", ["ngRoute"]);

    app.config(function ($routeProvider) {
        $routeProvider
            .when("/admin", {
                templateUrl: "./controllers/adminController/admin.html"
            }).when("/search", {
                templateUrl: "./controllers/searchController/search.html"
            }).when("/intro", {
                templateUrl: "./controllers/introController/intro.html"
            }).when("/help", {
                templateUrl: "./directives/help.html"
            }).when("/login", {
                templateUrl: "./controllers/loginController/login.html"
            }).when("/register", {
                templateUrl: "./controllers/loginController/register.html"
            }).when("/password", {
                templateUrl: "./controllers/loginController/password.html"
            }).when("/user", {
                templateUrl: "./controllers/userController/user.html"
            }).when("/user/:param", {
                templateUrl: "./controllers/userController/user.html",
                controller: 'userController'
            }).when("/me", {
                templateUrl: "./controllers/userController/me.html"
            }).when("/event", {
                templateUrl: "./controllers/eventController/event.html"
            }).when("/addEvent", {
                templateUrl: "./controllers/eventController/addEvent.html"
            }).when("/location", {
                templateUrl: "./controllers/locationController/location.html"
            }).otherwise({
                redirectTo: "/intro"
            });
    });

    app.directive("searchresult", function () {
        return {
            restrict: 'E',
            templateUrl: 'directives/searchResult.html'
        };
    });

    app.service('sharedProperties', function () {
        var property = 'First';

        return {
            getProperty: function () {
                return property;
            },
            setProperty: function (value) {
                property = value;
            }
        };
    });

})();

/**
 * Created by Jonatan on 6/12/2015.
 */

(function () {
    "use strict";

    var adminController = function ($scope) {

    };

    angular.module("geofeelings").controller("adminController", ["$scope", adminController]);
})();
/**
 * Created by Jonatan on 1/12/2015.
 */

(function () {
    "use strict";

    var introController = function ($scope, $http) {


        //SMILEY TEKENEN
        $scope.sliderValue = 50;
        $scope.moodWord = null;
        var c = document.getElementById("smileyCanvas");
        var ctx = c.getContext("2d");

        //telkens slidervalue verandert gezichtje tekenen
        $scope.$watch("sliderValue", function (newValue, oldValue) {
            ctx.clearRect(0, 0, c.width, c.height); //canvas clearen voor nieuw frame

            var mood = $scope.sliderValue;
            giveMoodWord();
            //offset positie mond
            var offsetX = c.width/5;
            var offSetY = c.width/2.14 + (mood / (c.width/6));

            //variabelen voor beziercurve (= mond)
            var SPx = offsetX;
            var SPy = offSetY + 100 - (mood / 10 * 8);
            var H1x = offsetX;
            var H1y = offSetY + (mood / 10 * 12);
            var H2x = offsetX + 180;
            var H2y = offSetY + (mood / 10 * 12);
            var EPx = offsetX + (c.width/1.666);
            var EPy = offSetY + 100 - (mood / 10 * 8);

            //rood en groen bereken voor achtergrond hoofd
            var bgR = Math.round(170 - (mood / 100) * 170);
            var bgG = Math.round(mood / 100 * 132);

            //hoofd
            ctx.lineWidth = c.width/60;
            ctx.beginPath();
            ctx.arc((c.width/2), (c.width/2), (c.width/2.07), 0, 2 * Math.PI);
            ctx.fillStyle = "rgb(" + bgR + "," + bgG + ",0)";
            ctx.fill();
            ctx.stroke();

            //mond

            ctx.lineWidth = c.width/30;
            ctx.beginPath();
            ctx.moveTo(SPx, SPy);
            ctx.bezierCurveTo(H1x, H1y, H2x, H2y, EPx, EPy);
            ctx.stroke();
            ctx.lineCap = "round";

            //oog links

            ctx.lineWidth = c.width/60;
            ctx.beginPath();
            ctx.arc(c.width/3, c.width/3, c.width/15, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.stroke();

            //oog rechts
            ctx.beginPath();
            ctx.arc(c.width/3*2, c.width/3, c.width/15, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.stroke();
        });

        var moodwords = ["horrible", "really bad", "bad", "okay", "good", "really good", "excellent"];

        var giveMoodWord = function () {
            if ($scope.sliderValue < 5) {
                $scope.moodWord = moodwords[0];
            }
            else if ($scope.sliderValue < 25) {
                $scope.moodWord = moodwords[1];
            }
            else if ($scope.sliderValue < 40) {
                $scope.moodWord = moodwords[2];
            }
            else if ($scope.sliderValue < 60) {
                $scope.moodWord = moodwords[3];
            }
            else if ($scope.sliderValue < 75) {
                $scope.moodWord = moodwords[4];
            }
            else if ($scope.sliderValue < 95) {
                $scope.moodWord = moodwords[5];
            }
            else {
                $scope.moodWord = moodwords[6];
            }
        };

        $scope.postShare = function () {
            var data = { "userid": 0, "eventid": 0,"time":Date.now,"mood":$scope.sliderValue,"lat":0,"lng": 0};

            $http({
                url: 'http://localhost:3000/api/share',
                method: 'POST',
                data: data,
                headers: { 'Content-Type': 'application/json' }
            }).
                success(function (serverData) {
                    console.log("jow");
                    console.log("ServerData:", serverData);});

              /*
            $http.post(
                'http://localhost:3000/api/share',
                JSON.stringify(data),
                {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }
            ).success(function (data) {
                    console.log("succes!");
                    $scope.person = data;
                });*/
        };
    };

    angular.module("geofeelings").controller("introController", ["$scope","$http", introController]);
})();
/**
 * Created by Jonatan on 4/12/2015.
 */


(function () {
    "use strict";

    var eventController = function ($scope) {

    };

    angular.module("geofeelings").controller("eventController", ["$scope", eventController]);
})();
/**
 * Created by Jonatan on 6/12/2015.
 */

(function () {
    "use strict";

    var locationController = function ($scope) {

    };

    angular.module("geofeelings").controller("locationController", ["$scope", locationController]);
})();
/**
 * Created by Jonatan on 26/11/2015.
 */

(function () {
    "use strict";

    var loginController = function ($scope, $http, $location) {
        $scope.login = function () {
            $http.post('/login', {
                username : this.username,
                password : this.password
            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });
        };

        $scope.register = function() {
            $http.post('/register', {
                username : this.username,
                password : this.password,
                email : this.email
            }).success(function (data) {
                $scope.error = data.error;
                $location.path(data.redirect);
            });
        };
    };

    angular.module("geofeelings").controller("loginController", ["$scope", "$http", "$location", loginController]);
})();
/**
 * Created by Jonatan on 21/11/2015.
 */

(function () {
    "use strict";

    var mainController = function ($scope) {
        if (navigator.geolocation) {
            $scope.image = "./assets/common.png";
            $scope.mapOptions = {
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                disableDefaultUI: true
            };

            $scope.map = new google.maps.Map(document.querySelector("#map"), $scope.mapOptions);

            navigator.geolocation.getCurrentPosition(function (position) {
                $scope.map.setCenter(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
                $scope.marker = new google.maps.Marker({
                    position: $scope.map.getCenter(),
                    map: $scope.map,
                    icon: $scope.image
                });
            });
        } else {
            //throw exception
        }
    };

    angular.module("geofeelings").controller("mainController", ["$scope", mainController]);
})();
/**
 * Created by Jonatan on 25/11/2015.
 */


(function () {
    "use strict";

    var searchController = function ($scope, searchService, sharedProperties) {

        $scope.searchModel = null;

        $scope.searchOnSubmit = function (formObj) {
            if ($scope.searchModel.length > 0) {
                searchNow();
            }
        };
        $scope.searchOnKeyPress = function () {
            if ($scope.searchModel !== null) {
                searchNow();
            }
        };

        $scope.filterSearchResults = function (i) {
            if ($scope.searchModel === "") {
                return false;
            }

            if (i.username.toLowerCase().indexOf($scope.searchModel.toLocaleLowerCase()) >= 0) {
                return true;
            }
            if (i.description !== undefined) {
                if (i.description.toLowerCase().indexOf($scope.searchModel.toLocaleLowerCase()) >= 0) {
                    return true;
                }
            }

            return false;
        };


        var searchNow = function () {
            searchService.search($scope.searchModel).then(onResultsReady);
        };

        var onResultsReady = function (res) {
            $scope.searchResults = res;
        };

        var onResultsError = function (err) {
        };
    };

    angular.module("geofeelings").controller("searchController", ["$scope", "searchService","sharedProperties", searchController]);
})();
/**
 * Created by Jonatan on 1/12/2015.
 */

(function () {
        "use strict";

        var userController = function ($scope, $location, searchService) {

            $scope.init = function () {
                var userid = $location.search().userid;
                searchService.searchUserFromId(userid).then(userFoundWithId);
               //searchService.getSharesByUserId(userid).then(sharesFoundWithId); //IMPLEMENTEREN ALS JONATAN DE API FTIE HEEFT AANGEMAAKT
            };

            var userFoundWithId = function (res) {
                    $scope.userfoundwithid = res;

                    if(res.lat !== undefined && res.lat!==undefined) {
                        $scope.map.setCenter(new google.maps.LatLng(res.lat, res.lng));
                        if ($scope.marker !== undefined) {
                            $scope.marker.setMap(null); //verwijdert alle markers eerst
                        }
                        $scope.marker = new google.maps.Marker({
                            position: {lat: res.lat, lng: res.lng},
                            map: $scope.map,
                            icon: $scope.image
                        });
                    }
                };

            var sharesFoundWithId = function (res) {

                $scope.shareFoundWithUserId = res;


                //markers plaatsen en kaart verplaatsen naar hun gemiddelde
                var minLat = 100,
                    maxLat = 0,
                    minLng = 100,
                    maxLng = 0,
                    teller = 0,
                    gemLat = 0,
                    gemLng = 0;

                $scope.marker.setMap(null); //verwijdert alle markers eerst
                res.forEach(function (res) {
                    teller++;
                    if (res.lat < minLat) {
                        minLat = res.lat;
                    }
                    else if (res.lat > maxLat) {
                        maxLat = res.lat;
                    }

                    if (res.lng < minLng) {
                        minLng = res.lng;
                    }
                    else if (res.lng > maxLng) {
                        maxLng = res.lng;
                    }

                    $scope.marker = new google.maps.Marker({
                        position: {lat: res.lat, lng: res.lng},
                        map: $scope.map,
                        icon: $scope.image
                    });

                });

                if (teller == 1) {
                    gemLat = res[0].lat;
                    gemLng = res[0].lng;
                }
                else {
                    gemLat = (maxLat - minLat) / 2 + minLat;
                    gemLng = (maxLng - minLng) / 2 + minLng;
                }

                $scope.map.setCenter(new google.maps.LatLng(gemLat, gemLng));
                $scope.map.setZoom(12);
                //klaar met markers plaatsen en kaart verplaatsen naar hun gemiddelde
            };
        };

        angular.module("geofeelings").controller("userController", ["$scope", "$location", "searchService", userController]);
    })
();
(function () {
    "use strict";

    var searchService = function ($http) {

        var search = function (searchString) {
            var url = 'http://localhost:3000/api/users';
            return $http.get(url).then(function (response) {

                var arSearchResults = [];
                angular.forEach(response.data, function (searchR) {
                    var newSR = new SearchResult(searchR._id, searchR.username);
                    arSearchResults.push(newSR);
                });
                return arSearchResults;
            });
        };

        var searchUserFromId = function (searchString) {
            var url = 'http://localhost:3000/api/user/' + searchString;
            return $http.get(url).then(function (response) {
                return new GfUser(
                    response.data._id,
                    response.data.username,
                    response.data.email,
                    response.data.userimage,
                    response.data.age,
                    response.data.lat,
                    response.data.lng,
                    response.data.chat,
                    response.data.admin
                );

            });
        };

        var getSharesByUserId = function (userid) {
            var url = 'http://localhost:3000/api/user/';
            return $http.get(url).then(function (response) {
                var sharesfound = [];
                angular.forEach(response.data.shares.share, function (share) {
                    if (share.userid == userid) {
                        var newShare = new GFShare(share._id.$oid, share.user, share.userid, share.time.$date, share.mood, share.lat, share.lng);
                        sharesfound.push(newShare);
                    }
                });
                return sharesfound;
            });
        };

        return {
            search: search,
            searchUserFromId: searchUserFromId,
            getSharesByUserId: getSharesByUserId
        };
    };
    angular.module("geofeelings").factory("searchService", ["$http", searchService]);
})();
function GFShare(id, userid, eventid, time, mood, lat, lng) {
    this.id = id;
    this.user = user;
    this.userid = userid;
    this.eventid = eventid;
    this.time = time;
    this.mood = mood;
    this.lat = lat;
    this.lng = lng;
}
GFShare.prototype.toString = function () {
    return this.user + " (" + this.time + ")";
};

function GfUser(id, username, email, userimage, age, lat, lng, chat, admin) {
    this.id = id;
    this.username = username;
    this.email = email;
    this.userimage = userimage;
    this.age = age;
    this.lat = lat;
    this.lng = lng;
    this.chat = chat;
    this.admin = admin;
}
GfUser.prototype.toString = function () {
    return this.username;
};

function SearchResult(id,username)
{
    this.id = id;
    this.username = username;
}
SearchResult.prototype.toString = function() {
    return this.title;
};

/**
 * Created by Jonatan on 22/11/2015.
 */

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFkbWluQ29udHJvbGxlci9hZG1pbkNvbnRyb2xsZXIuanMiLCJpbnRyb0NvbnRyb2xsZXIvaW50cm9Db250cm9sbGVyLmpzIiwiZXZlbnRDb250cm9sbGVyL2V2ZW50Q29udHJvbGxlci5qcyIsImxvY2F0aW9uQ29udHJvbGxlci9sb2NhdGlvbkNvbnRyb2xsZXIuanMiLCJsb2dpbkNvbnRyb2xsZXIvbG9naW5Db250cm9sbGVyLmpzIiwibWFpbkNvbnRyb2xsZXIvbWFpbkNvbnRyb2xsZXIuanMiLCJzZWFyY2hDb250cm9sbGVyL3NlYXJjaENvbnRyb2xsZXIuanMiLCJ1c2VyQ29udHJvbGxlci91c2VyQ29udHJvbGxlci5qcyIsInNlYXJjaFNlcnZpY2UuanMiLCJnZlNoYXJlLmpzIiwiZ2ZVc2VyLmpzIiwiU2VhcmNoUmVzdWx0LmpzIiwibWFwRXhjZXB0aW9uLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiLCBbXCJuZ1JvdXRlXCJdKTtcclxuXHJcbiAgICBhcHAuY29uZmlnKGZ1bmN0aW9uICgkcm91dGVQcm92aWRlcikge1xyXG4gICAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKFwiL2FkbWluXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvYWRtaW5Db250cm9sbGVyL2FkbWluLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL3NlYXJjaFwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL3NlYXJjaENvbnRyb2xsZXIvc2VhcmNoLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2ludHJvXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvaW50cm9Db250cm9sbGVyL2ludHJvLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2hlbHBcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9kaXJlY3RpdmVzL2hlbHAuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvbG9naW5cIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIvbG9naW4uaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvcmVnaXN0ZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIvcmVnaXN0ZXIuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvcGFzc3dvcmRcIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIvcGFzc3dvcmQuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvdXNlclwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL3VzZXJDb250cm9sbGVyL3VzZXIuaHRtbFwiXHJcbiAgICAgICAgICAgIH0pLndoZW4oXCIvdXNlci86cGFyYW1cIiwge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi9jb250cm9sbGVycy91c2VyQ29udHJvbGxlci91c2VyLmh0bWxcIixcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyQ29udHJvbGxlcidcclxuICAgICAgICAgICAgfSkud2hlbihcIi9tZVwiLCB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbnRyb2xsZXJzL3VzZXJDb250cm9sbGVyL21lLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2V2ZW50XCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvZXZlbnRDb250cm9sbGVyL2V2ZW50Lmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2FkZEV2ZW50XCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvZXZlbnRDb250cm9sbGVyL2FkZEV2ZW50Lmh0bWxcIlxyXG4gICAgICAgICAgICB9KS53aGVuKFwiL2xvY2F0aW9uXCIsIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi4vY29udHJvbGxlcnMvbG9jYXRpb25Db250cm9sbGVyL2xvY2F0aW9uLmh0bWxcIlxyXG4gICAgICAgICAgICB9KS5vdGhlcndpc2Uoe1xyXG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUbzogXCIvaW50cm9cIlxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFwcC5kaXJlY3RpdmUoXCJzZWFyY2hyZXN1bHRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZGlyZWN0aXZlcy9zZWFyY2hSZXN1bHQuaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLnNlcnZpY2UoJ3NoYXJlZFByb3BlcnRpZXMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHByb3BlcnR5ID0gJ0ZpcnN0JztcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0UHJvcGVydHk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0UHJvcGVydHk6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHkgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gNi8xMi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgYWRtaW5Db250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSkge1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwiYWRtaW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBhZG1pbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDEvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGludHJvQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICRodHRwKSB7XHJcblxyXG5cclxuICAgICAgICAvL1NNSUxFWSBURUtFTkVOXHJcbiAgICAgICAgJHNjb3BlLnNsaWRlclZhbHVlID0gNTA7XHJcbiAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbnVsbDtcclxuICAgICAgICB2YXIgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic21pbGV5Q2FudmFzXCIpO1xyXG4gICAgICAgIHZhciBjdHggPSBjLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbiAgICAgICAgLy90ZWxrZW5zIHNsaWRlcnZhbHVlIHZlcmFuZGVydCBnZXppY2h0amUgdGVrZW5lblxyXG4gICAgICAgICRzY29wZS4kd2F0Y2goXCJzbGlkZXJWYWx1ZVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgYy53aWR0aCwgYy5oZWlnaHQpOyAvL2NhbnZhcyBjbGVhcmVuIHZvb3IgbmlldXcgZnJhbWVcclxuXHJcbiAgICAgICAgICAgIHZhciBtb29kID0gJHNjb3BlLnNsaWRlclZhbHVlO1xyXG4gICAgICAgICAgICBnaXZlTW9vZFdvcmQoKTtcclxuICAgICAgICAgICAgLy9vZmZzZXQgcG9zaXRpZSBtb25kXHJcbiAgICAgICAgICAgIHZhciBvZmZzZXRYID0gYy53aWR0aC81O1xyXG4gICAgICAgICAgICB2YXIgb2ZmU2V0WSA9IGMud2lkdGgvMi4xNCArIChtb29kIC8gKGMud2lkdGgvNikpO1xyXG5cclxuICAgICAgICAgICAgLy92YXJpYWJlbGVuIHZvb3IgYmV6aWVyY3VydmUgKD0gbW9uZClcclxuICAgICAgICAgICAgdmFyIFNQeCA9IG9mZnNldFg7XHJcbiAgICAgICAgICAgIHZhciBTUHkgPSBvZmZTZXRZICsgMTAwIC0gKG1vb2QgLyAxMCAqIDgpO1xyXG4gICAgICAgICAgICB2YXIgSDF4ID0gb2Zmc2V0WDtcclxuICAgICAgICAgICAgdmFyIEgxeSA9IG9mZlNldFkgKyAobW9vZCAvIDEwICogMTIpO1xyXG4gICAgICAgICAgICB2YXIgSDJ4ID0gb2Zmc2V0WCArIDE4MDtcclxuICAgICAgICAgICAgdmFyIEgyeSA9IG9mZlNldFkgKyAobW9vZCAvIDEwICogMTIpO1xyXG4gICAgICAgICAgICB2YXIgRVB4ID0gb2Zmc2V0WCArIChjLndpZHRoLzEuNjY2KTtcclxuICAgICAgICAgICAgdmFyIEVQeSA9IG9mZlNldFkgKyAxMDAgLSAobW9vZCAvIDEwICogOCk7XHJcblxyXG4gICAgICAgICAgICAvL3Jvb2QgZW4gZ3JvZW4gYmVyZWtlbiB2b29yIGFjaHRlcmdyb25kIGhvb2ZkXHJcbiAgICAgICAgICAgIHZhciBiZ1IgPSBNYXRoLnJvdW5kKDE3MCAtIChtb29kIC8gMTAwKSAqIDE3MCk7XHJcbiAgICAgICAgICAgIHZhciBiZ0cgPSBNYXRoLnJvdW5kKG1vb2QgLyAxMDAgKiAxMzIpO1xyXG5cclxuICAgICAgICAgICAgLy9ob29mZFxyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYy53aWR0aC82MDtcclxuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICBjdHguYXJjKChjLndpZHRoLzIpLCAoYy53aWR0aC8yKSwgKGMud2lkdGgvMi4wNyksIDAsIDIgKiBNYXRoLlBJKTtcclxuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiKFwiICsgYmdSICsgXCIsXCIgKyBiZ0cgKyBcIiwwKVwiO1xyXG4gICAgICAgICAgICBjdHguZmlsbCgpO1xyXG4gICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcblxyXG4gICAgICAgICAgICAvL21vbmRcclxuXHJcbiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBjLndpZHRoLzMwO1xyXG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oU1B4LCBTUHkpO1xyXG4gICAgICAgICAgICBjdHguYmV6aWVyQ3VydmVUbyhIMXgsIEgxeSwgSDJ4LCBIMnksIEVQeCwgRVB5KTtcclxuICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICBjdHgubGluZUNhcCA9IFwicm91bmRcIjtcclxuXHJcbiAgICAgICAgICAgIC8vb29nIGxpbmtzXHJcblxyXG4gICAgICAgICAgICBjdHgubGluZVdpZHRoID0gYy53aWR0aC82MDtcclxuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICBjdHguYXJjKGMud2lkdGgvMywgYy53aWR0aC8zLCBjLndpZHRoLzE1LCAwLCAyICogTWF0aC5QSSk7XHJcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgICAgICAgICBjdHguZmlsbCgpO1xyXG4gICAgICAgICAgICBjdHguc3Ryb2tlKCk7XHJcblxyXG4gICAgICAgICAgICAvL29vZyByZWNodHNcclxuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICBjdHguYXJjKGMud2lkdGgvMyoyLCBjLndpZHRoLzMsIGMud2lkdGgvMTUsIDAsIDIgKiBNYXRoLlBJKTtcclxuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7XHJcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XHJcbiAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIG1vb2R3b3JkcyA9IFtcImhvcnJpYmxlXCIsIFwicmVhbGx5IGJhZFwiLCBcImJhZFwiLCBcIm9rYXlcIiwgXCJnb29kXCIsIFwicmVhbGx5IGdvb2RcIiwgXCJleGNlbGxlbnRcIl07XHJcblxyXG4gICAgICAgIHZhciBnaXZlTW9vZFdvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2xpZGVyVmFsdWUgPCA1KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubW9vZFdvcmQgPSBtb29kd29yZHNbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgMjUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1sxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICgkc2NvcGUuc2xpZGVyVmFsdWUgPCA0MCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5zbGlkZXJWYWx1ZSA8IDYwKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubW9vZFdvcmQgPSBtb29kd29yZHNbM107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnNsaWRlclZhbHVlIDwgNzUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb29kV29yZCA9IG1vb2R3b3Jkc1s0XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICgkc2NvcGUuc2xpZGVyVmFsdWUgPCA5NSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vb2RXb3JkID0gbW9vZHdvcmRzWzZdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnBvc3RTaGFyZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7IFwidXNlcmlkXCI6IDAsIFwiZXZlbnRpZFwiOiAwLFwidGltZVwiOkRhdGUubm93LFwibW9vZFwiOiRzY29wZS5zbGlkZXJWYWx1ZSxcImxhdFwiOjAsXCJsbmdcIjogMH07XHJcblxyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3NoYXJlJyxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XHJcbiAgICAgICAgICAgIH0pLlxyXG4gICAgICAgICAgICAgICAgc3VjY2VzcyhmdW5jdGlvbiAoc2VydmVyRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiam93XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VydmVyRGF0YTpcIiwgc2VydmVyRGF0YSk7fSk7XHJcblxyXG4gICAgICAgICAgICAgIC8qXHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoXHJcbiAgICAgICAgICAgICAgICAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9zaGFyZScsXHJcbiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3VjY2VzIVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGVyc29uID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pOyovXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwiaW50cm9Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLFwiJGh0dHBcIiwgaW50cm9Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiA0LzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgZXZlbnRDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSkge1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5jb250cm9sbGVyKFwiZXZlbnRDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBldmVudENvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDYvMTIvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGxvY2F0aW9uQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImxvY2F0aW9uQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgbG9jYXRpb25Db250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiAyNi8xMS8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgbG9naW5Db250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgOiB0aGlzLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQgOiB0aGlzLnBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGRhdGEuZXJyb3I7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChkYXRhLnJlZGlyZWN0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy9yZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogdGhpcy51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkIDogdGhpcy5wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIGVtYWlsIDogdGhpcy5lbWFpbFxyXG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBkYXRhLmVycm9yO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoZGF0YS5yZWRpcmVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcImxvZ2luQ29udHJvbGxlclwiLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRsb2NhdGlvblwiLCBsb2dpbkNvbnRyb2xsZXJdKTtcclxufSkoKTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIxLzExLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBtYWluQ29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUpIHtcclxuICAgICAgICBpZiAobmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pbWFnZSA9IFwiLi9hc3NldHMvY29tbW9uLnBuZ1wiO1xyXG4gICAgICAgICAgICAkc2NvcGUubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHpvb206IDE1LFxyXG4gICAgICAgICAgICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUCxcclxuICAgICAgICAgICAgICAgIGRpc2FibGVEZWZhdWx0VUk6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFwXCIpLCAkc2NvcGUubWFwT3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsIHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJHNjb3BlLm1hcC5nZXRDZW50ZXIoKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJHNjb3BlLmltYWdlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy90aHJvdyBleGNlcHRpb25cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcIm1haW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBtYWluQ29udHJvbGxlcl0pO1xyXG59KSgpOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEpvbmF0YW4gb24gMjUvMTEvMjAxNS5cclxuICovXHJcblxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBzZWFyY2hDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgc2VhcmNoU2VydmljZSwgc2hhcmVkUHJvcGVydGllcykge1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VhcmNoTW9kZWwgPSBudWxsO1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VhcmNoT25TdWJtaXQgPSBmdW5jdGlvbiAoZm9ybU9iaikge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNlYXJjaE1vZGVsLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaE5vdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuc2VhcmNoT25LZXlQcmVzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zZWFyY2hNb2RlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoTm93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZmlsdGVyU2VhcmNoUmVzdWx0cyA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2VhcmNoTW9kZWwgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGkudXNlcm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCRzY29wZS5zZWFyY2hNb2RlbC50b0xvY2FsZUxvd2VyQ2FzZSgpKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaS5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJHNjb3BlLnNlYXJjaE1vZGVsLnRvTG9jYWxlTG93ZXJDYXNlKCkpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB2YXIgc2VhcmNoTm93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWFyY2hTZXJ2aWNlLnNlYXJjaCgkc2NvcGUuc2VhcmNoTW9kZWwpLnRoZW4ob25SZXN1bHRzUmVhZHkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBvblJlc3VsdHNSZWFkeSA9IGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaFJlc3VsdHMgPSByZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG9uUmVzdWx0c0Vycm9yID0gZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcInNlYXJjaENvbnRyb2xsZXJcIiwgW1wiJHNjb3BlXCIsIFwic2VhcmNoU2VydmljZVwiLFwic2hhcmVkUHJvcGVydGllc1wiLCBzZWFyY2hDb250cm9sbGVyXSk7XHJcbn0pKCk7IiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSm9uYXRhbiBvbiAxLzEyLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICAgICAgdmFyIHVzZXJDb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzZWFyY2hTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1c2VyaWQgPSAkbG9jYXRpb24uc2VhcmNoKCkudXNlcmlkO1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoU2VydmljZS5zZWFyY2hVc2VyRnJvbUlkKHVzZXJpZCkudGhlbih1c2VyRm91bmRXaXRoSWQpO1xyXG4gICAgICAgICAgICAgICAvL3NlYXJjaFNlcnZpY2UuZ2V0U2hhcmVzQnlVc2VySWQodXNlcmlkKS50aGVuKHNoYXJlc0ZvdW5kV2l0aElkKTsgLy9JTVBMRU1FTlRFUkVOIEFMUyBKT05BVEFOIERFIEFQSSBGVElFIEhFRUZUIEFBTkdFTUFBS1RcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1c2VyRm91bmRXaXRoSWQgPSBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJmb3VuZHdpdGhpZCA9IHJlcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzLmxhdCAhPT0gdW5kZWZpbmVkICYmIHJlcy5sYXQhPT11bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhyZXMubGF0LCByZXMubG5nKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubWFya2VyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tYXJrZXIuc2V0TWFwKG51bGwpOyAvL3ZlcndpamRlcnQgYWxsZSBtYXJrZXJzIGVlcnN0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHtsYXQ6IHJlcy5sYXQsIGxuZzogcmVzLmxuZ30sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiAkc2NvcGUuaW1hZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzaGFyZXNGb3VuZFdpdGhJZCA9IGZ1bmN0aW9uIChyZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hhcmVGb3VuZFdpdGhVc2VySWQgPSByZXM7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vbWFya2VycyBwbGFhdHNlbiBlbiBrYWFydCB2ZXJwbGFhdHNlbiBuYWFyIGh1biBnZW1pZGRlbGRlXHJcbiAgICAgICAgICAgICAgICB2YXIgbWluTGF0ID0gMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG1heExhdCA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgbWluTG5nID0gMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG1heExuZyA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVsbGVyID0gMCxcclxuICAgICAgICAgICAgICAgICAgICBnZW1MYXQgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGdlbUxuZyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcmtlci5zZXRNYXAobnVsbCk7IC8vdmVyd2lqZGVydCBhbGxlIG1hcmtlcnMgZWVyc3RcclxuICAgICAgICAgICAgICAgIHJlcy5mb3JFYWNoKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZWxsZXIrKztcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmxhdCA8IG1pbkxhdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5MYXQgPSByZXMubGF0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXMubGF0ID4gbWF4TGF0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heExhdCA9IHJlcy5sYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmxuZyA8IG1pbkxuZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5MbmcgPSByZXMubG5nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXMubG5nID4gbWF4TG5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heExuZyA9IHJlcy5sbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7bGF0OiByZXMubGF0LCBsbmc6IHJlcy5sbmd9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXA6ICRzY29wZS5tYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICRzY29wZS5pbWFnZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0ZWxsZXIgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdlbUxhdCA9IHJlc1swXS5sYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2VtTG5nID0gcmVzWzBdLmxuZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdlbUxhdCA9IChtYXhMYXQgLSBtaW5MYXQpIC8gMiArIG1pbkxhdDtcclxuICAgICAgICAgICAgICAgICAgICBnZW1MbmcgPSAobWF4TG5nIC0gbWluTG5nKSAvIDIgKyBtaW5Mbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRDZW50ZXIobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhnZW1MYXQsIGdlbUxuZykpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5zZXRab29tKDEyKTtcclxuICAgICAgICAgICAgICAgIC8va2xhYXIgbWV0IG1hcmtlcnMgcGxhYXRzZW4gZW4ga2FhcnQgdmVycGxhYXRzZW4gbmFhciBodW4gZ2VtaWRkZWxkZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFuZ3VsYXIubW9kdWxlKFwiZ2VvZmVlbGluZ3NcIikuY29udHJvbGxlcihcInVzZXJDb250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRsb2NhdGlvblwiLCBcInNlYXJjaFNlcnZpY2VcIiwgdXNlckNvbnRyb2xsZXJdKTtcclxuICAgIH0pXHJcbigpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgc2VhcmNoU2VydmljZSA9IGZ1bmN0aW9uICgkaHR0cCkge1xyXG5cclxuICAgICAgICB2YXIgc2VhcmNoID0gZnVuY3Rpb24gKHNlYXJjaFN0cmluZykge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvdXNlcnMnO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYXJTZWFyY2hSZXN1bHRzID0gW107XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocmVzcG9uc2UuZGF0YSwgZnVuY3Rpb24gKHNlYXJjaFIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3U1IgPSBuZXcgU2VhcmNoUmVzdWx0KHNlYXJjaFIuX2lkLCBzZWFyY2hSLnVzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBhclNlYXJjaFJlc3VsdHMucHVzaChuZXdTUik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhclNlYXJjaFJlc3VsdHM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZWFyY2hVc2VyRnJvbUlkID0gZnVuY3Rpb24gKHNlYXJjaFN0cmluZykge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvdXNlci8nICsgc2VhcmNoU3RyaW5nO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR2ZVc2VyKFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLnVzZXJpbWFnZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmFnZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmxhdCxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmxuZyxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmNoYXQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5hZG1pblxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRTaGFyZXNCeVVzZXJJZCA9IGZ1bmN0aW9uICh1c2VyaWQpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3VzZXIvJztcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2hhcmVzZm91bmQgPSBbXTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyZXNwb25zZS5kYXRhLnNoYXJlcy5zaGFyZSwgZnVuY3Rpb24gKHNoYXJlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNoYXJlLnVzZXJpZCA9PSB1c2VyaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1NoYXJlID0gbmV3IEdGU2hhcmUoc2hhcmUuX2lkLiRvaWQsIHNoYXJlLnVzZXIsIHNoYXJlLnVzZXJpZCwgc2hhcmUudGltZS4kZGF0ZSwgc2hhcmUubW9vZCwgc2hhcmUubGF0LCBzaGFyZS5sbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaGFyZXNmb3VuZC5wdXNoKG5ld1NoYXJlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzaGFyZXNmb3VuZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsXHJcbiAgICAgICAgICAgIHNlYXJjaFVzZXJGcm9tSWQ6IHNlYXJjaFVzZXJGcm9tSWQsXHJcbiAgICAgICAgICAgIGdldFNoYXJlc0J5VXNlcklkOiBnZXRTaGFyZXNCeVVzZXJJZFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJnZW9mZWVsaW5nc1wiKS5mYWN0b3J5KFwic2VhcmNoU2VydmljZVwiLCBbXCIkaHR0cFwiLCBzZWFyY2hTZXJ2aWNlXSk7XHJcbn0pKCk7IiwiZnVuY3Rpb24gR0ZTaGFyZShpZCwgdXNlcmlkLCBldmVudGlkLCB0aW1lLCBtb29kLCBsYXQsIGxuZykge1xyXG4gICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgdGhpcy51c2VyID0gdXNlcjtcclxuICAgIHRoaXMudXNlcmlkID0gdXNlcmlkO1xyXG4gICAgdGhpcy5ldmVudGlkID0gZXZlbnRpZDtcclxuICAgIHRoaXMudGltZSA9IHRpbWU7XHJcbiAgICB0aGlzLm1vb2QgPSBtb29kO1xyXG4gICAgdGhpcy5sYXQgPSBsYXQ7XHJcbiAgICB0aGlzLmxuZyA9IGxuZztcclxufVxyXG5HRlNoYXJlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLnVzZXIgKyBcIiAoXCIgKyB0aGlzLnRpbWUgKyBcIilcIjtcclxufTtcclxuIiwiZnVuY3Rpb24gR2ZVc2VyKGlkLCB1c2VybmFtZSwgZW1haWwsIHVzZXJpbWFnZSwgYWdlLCBsYXQsIGxuZywgY2hhdCwgYWRtaW4pIHtcclxuICAgIHRoaXMuaWQgPSBpZDtcclxuICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcclxuICAgIHRoaXMuZW1haWwgPSBlbWFpbDtcclxuICAgIHRoaXMudXNlcmltYWdlID0gdXNlcmltYWdlO1xyXG4gICAgdGhpcy5hZ2UgPSBhZ2U7XHJcbiAgICB0aGlzLmxhdCA9IGxhdDtcclxuICAgIHRoaXMubG5nID0gbG5nO1xyXG4gICAgdGhpcy5jaGF0ID0gY2hhdDtcclxuICAgIHRoaXMuYWRtaW4gPSBhZG1pbjtcclxufVxyXG5HZlVzZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlcm5hbWU7XHJcbn07XHJcbiIsImZ1bmN0aW9uIFNlYXJjaFJlc3VsdChpZCx1c2VybmFtZSlcclxue1xyXG4gICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xyXG59XHJcblNlYXJjaFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLnRpdGxlO1xyXG59O1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBKb25hdGFuIG9uIDIyLzExLzIwMTUuXHJcbiAqL1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
